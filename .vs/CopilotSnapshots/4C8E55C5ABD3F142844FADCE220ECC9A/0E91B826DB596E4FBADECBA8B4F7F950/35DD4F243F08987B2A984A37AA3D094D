@echo off
chcp 65001 >nul
echo.
echo ====================================
echo    🖥️ تطبيق سكني الدسكتوب 🖥️
echo ====================================
echo.

cd /d "%~dp0"

echo 📦 التحقق من تثبيت الاعتماديات...
if not exist "node_modules\electron" (
    echo 🔄 تثبيت اعتماديات Electron...
    npm install
    if errorlevel 1 (
        echo ❌ فشل في تثبيت الاعتماديات
        pause
        exit /b 1
    )
    echo ✅ تم تثبيت الاعتماديات بنجاح
) else (
    echo ✅ الاعتماديات مثبتة مسبقاً
)

echo.
echo 🚀 تشغيل تطبيق سكني الدسكتوب...
echo.
echo ⏳ انتظر قليلاً حتى يفتح التطبيق...
echo.
echo 💡 سيتم فتح:
echo    - خادم التطوير على المنفذ 8080
echo    - تطبيق Electron الدسكتوب
echo.

npm run electron-dev

if errorlevel 1 (
    echo.
    echo ❌ حدث خطأ في تشغيل التطبيق
    echo.
    echo 🔧 نصائح لحل المشكلة:
    echo    1. تأكد من تشغيل الأمر: npm install
    echo    2. تحقق من عدم تشغيل خادم آخر على المنفذ 8080
    echo    3. تأكد من وجود ملفات المشروع كاملة
    echo    4. جرب تشغيل: npm run dev أولاً للتأكد من عمل التطبيق
    echo.
    echo 🆘 للحصول على مساعدة إضافية:
    echo    - افتح نافذة أوامر جديدة وشغل: npm run dev
    echo    - ثم في نافذة أخرى شغل: npm run electron
    echo.
    pause
    exit /b 1
)

echo.
echo 👋 تم إغلاق التطبيق
echo.
echo 💡 لإنشاء ملف تثبيت قابل للتوزيع، شغل: build-desktop.bat
pause