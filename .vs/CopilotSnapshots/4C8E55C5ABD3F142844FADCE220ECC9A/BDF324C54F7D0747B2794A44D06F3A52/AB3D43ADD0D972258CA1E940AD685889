@echo off
chcp 65001 >nul
echo.
echo ===================================
echo    🎉 تطبيق سكني الدسكتوب 🎉
echo ===================================
echo.
echo ✅ تم إنشاء التطبيق الدسكتوب بنجاح!
echo.
echo 📁 موقع التطبيق: dist-packaged\Maskani-win32-x64\
echo 🚀 ملف التشغيل: Maskani.exe
echo.
echo ⚠️ مهم: لعرض البيانات، يجب تشغيل خادم التطبيق أولاً!
echo.
echo 🎯 خيارات التشغيل:
echo.
echo  1. تشغيل التطبيق مع الخادم (مُوصى به)
echo  2. تشغيل التطبيق الدسكتوب فقط
echo  3. تشغيل الخادم فقط
echo  4. فتح مجلد التطبيق في Explorer
echo  5. إنشاء اختصار على سطح المكتب
echo  6. إنشاء ملف مضغوط للتوزيع
echo  7. معلومات التطبيق
echo  0. العودة
echo.
set /p choice="اختر العملية المطلوبة (0-7): "

if "%choice%"=="1" goto run_with_server
if "%choice%"=="2" goto run_app_only
if "%choice%"=="3" goto run_server_only
if "%choice%"=="4" goto open_folder
if "%choice%"=="5" goto create_shortcut
if "%choice%"=="6" goto create_zip
if "%choice%"=="7" goto show_info
if "%choice%"=="0" goto exit
goto invalid

:run_with_server
echo.
echo 🚀 تشغيل التطبيق مع الخادم...
echo.
echo 📡 جاري تشغيل خادم التطبيق...
cd /d "%~dp0"

:: تشغيل الخادم في الخلفية
start /B npm run dev

:: انتظار 5 ثوان لتشغيل الخادم
echo ⏳ انتظار تشغيل الخادم... (5 ثوان)
timeout /t 5 /nobreak >nul

:: تشغيل التطبيق الدسكتوب
echo 🖥️ تشغيل التطبيق الدسكتوب...
if exist "dist-packaged\Maskani-win32-x64\Maskani.exe" (
    start "" "dist-packaged\Maskani-win32-x64\Maskani.exe"
    echo ✅ تم تشغيل التطبيق مع الخادم
    echo.
    echo 💡 ملاحظات:
    echo    - سيتم عرض البيانات من قاعدة البيانات
    echo    - إذا لم تظهر البيانات، اضغط Ctrl+Shift+R في التطبيق
    echo    - لإغلاق الخادم، اضغط Ctrl+C في نافذة الأوامر
) else (
    echo ❌ ملف التطبيق غير موجود
    echo 💡 تأكد من إنشاء التطبيق أولاً بتشغيل: npm run package
)
goto end

:run_app_only
echo.
echo 🚀 تشغيل التطبيق الدسكتوب فقط...
echo.
echo ⚠️ تحذير: بدون الخادم، قد لا تظهر البيانات بشكل صحيح
echo.
if exist "dist-packaged\Maskani-win32-x64\Maskani.exe" (
    start "" "dist-packaged\Maskani-win32-x64\Maskani.exe"
    echo ✅ تم تشغيل التطبيق
    echo.
    echo 💡 إذا لم تظهر البيانات:
    echo    1. أغلق التطبيق
    echo    2. اختر الخيار رقم 1 (تشغيل مع الخادم)
) else (
    echo ❌ ملف التطبيق غير موجود
)
goto end

:run_server_only
echo.
echo 📡 تشغيل خادم التطبيق فقط...
echo.
cd /d "%~dp0"
echo 🌐 الخادم سيعمل على: http://localhost:8080
echo 💡 يمكنك فتح هذا الرابط في المتصفح أو تشغيل التطبيق الدسكتوب
echo.
npm run dev
goto end

:open_folder
echo.
echo 📂 فتح مجلد التطبيق...
if exist "dist-packaged\Maskani-win32-x64" (
    explorer "dist-packaged\Maskani-win32-x64"
    echo ✅ تم فتح المجلد
) else (
    echo ❌ مجلد التطبيق غير موجود
)
goto end

:create_shortcut
echo.
echo 🔗 إنشاء اختصار على سطح المكتب...
if exist "dist-packaged\Maskani-win32-x64\Maskani.exe" (
    set "target=%~dp0dist-packaged\Maskani-win32-x64\Maskani.exe"
    set "shortcut=%USERPROFILE%\Desktop\سكني - تطبيق العقارات.lnk"
    powershell "$s=(New-Object -COM WScript.Shell).CreateShortcut('%shortcut%'); $s.TargetPath='%target%'; $s.Save()"
    echo ✅ تم إنشاء اختصار على سطح المكتب
    echo.
    echo 💡 لتشغيل التطبيق مع البيانات:
    echo    1. شغل هذا الملف أولاً: run-desktop-app.bat
    echo    2. اختر الخيار رقم 1
    echo    3. أو شغل الخادم يدوياً: npm run dev
) else (
    echo ❌ ملف التطبيق غير موجود
)
goto end

:create_zip
echo.
echo 📦 إنشاء ملف مضغوط للتوزيع...
if exist "dist-packaged\Maskani-win32-x64" (
    echo 📋 إنشاء ملف README للمستخدمين...
    echo ^> سكني - تطبيق العقارات الدسكتوب > temp_readme.txt
    echo. >> temp_readme.txt
    echo للتشغيل مع البيانات الكاملة: >> temp_readme.txt
    echo 1. تأكد من تثبيت Node.js >> temp_readme.txt
    echo 2. شغل الأمر: npm run dev >> temp_readme.txt
    echo 3. ثم شغل Maskani.exe >> temp_readme.txt
    echo. >> temp_readme.txt
    echo للتشغيل السريع بدون بيانات: >> temp_readme.txt
    echo - شغل Maskani.exe مباشرة >> temp_readme.txt
    
    powershell "Compress-Archive -Path 'dist-packaged\Maskani-win32-x64\*','temp_readme.txt' -DestinationPath 'سكني-تطبيق-دسكتوب-v1.0.zip' -Force"
    del temp_readme.txt >nul 2>&1
    echo ✅ تم إنشاء الملف المضغوط: سكني-تطبيق-دسكتوب-v1.0.zip
    echo 📤 يمكنك الآن مشاركة هذا الملف مع المستخدمين
) else (
    echo ❌ مجلد التطبيق غير موجود
)
goto end

:show_info
echo.
echo ℹ️ معلومات التطبيق المُنتج:
echo.
echo 📱 اسم التطبيق: سكني - تطبيق العقارات
echo 🏷️ الإصدار: 1.0.0
echo 💾 الحجم: ~186 MB
echo 🖥️ المنصة: Windows x64
echo 📁 المجلد: dist-packaged\Maskani-win32-x64\
echo 🚀 ملف التشغيل: Maskani.exe
echo.
echo 🎯 خصائص التطبيق:
echo   ✅ يعمل بدون تثبيت
echo   ✅ قابل للنقل بين الأجهزة
echo   ⚠️ يحتاج خادم للبيانات الكاملة
echo   ✅ واجهة دسكتوب أصلية
echo   ✅ أداء محسن
echo.
echo 📊 طرق التشغيل:
echo   🔸 مع البيانات: تشغيل الخادم + التطبيق
echo   🔸 بدون بيانات: تشغيل التطبيق فقط
echo   🔸 في المتصفح: http://localhost:8080
echo.
echo 📦 للتوزيع:
echo   1. انسخ مجلد "Maskani-win32-x64" كاملاً
echo   2. أو استخدم الملف المضغوط
echo   3. أرفق تعليمات التشغيل للمستخدمين
goto end

:invalid
echo.
echo ❌ اختيار غير صحيح
goto end

:exit
exit /b 0

:end
echo.
pause
cls
goto start

:start
goto :eof