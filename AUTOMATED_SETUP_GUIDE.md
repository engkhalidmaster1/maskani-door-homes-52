# 🤖 دليل الإعداد التلقائي

## ✅ ما تم تنفيذه تلقائياً:

### 1. تشغيل السيرفر ✅
- ✅ السيرفر يعمل على: **http://localhost:8082**
- ✅ المتصفح تم فتحه تلقائياً

---

## ⚠️ خطوتان يدويتان مطلوبتان منك:

### 🔴 الخطوة 1: نشر Edge Function (إجباري - 5 دقائق)

**لماذا لا يمكن تنفيذها تلقائياً؟**
- تحتاج تسجيل دخول Supabase بحسابك الشخصي
- تحتاج Project ID من مشروعك

**الأوامر (انسخ والصقها):**

```powershell
# في نافذة PowerShell جديدة:

# 1. تثبيت Supabase CLI
npm install -g supabase

# 2. تسجيل الدخول (سيفتح المتصفح للموافقة)
supabase login

# 3. ربط المشروع
# احصل على YOUR_PROJECT_ID من: https://supabase.com/dashboard/project/_/settings/general
supabase link --project-ref YOUR_PROJECT_ID

# 4. نشر Edge Function
supabase functions deploy create-user
```

**كيف تحصل على YOUR_PROJECT_ID:**
1. افتح: https://supabase.com/dashboard
2. اختر مشروع "maskani"
3. اذهب إلى **Settings** → **General**
4. انسخ **Reference ID** (مثال: abcd1234efgh)
5. استبدل `YOUR_PROJECT_ID` بالقيمة المنسوخة

**التحقق من النجاح:**
```powershell
supabase functions list
```
يجب أن ترى `create-user` في القائمة ✅

---

### 🟡 الخطوة 2: استعادة صلاحيات المدير (إن لزم)

**هل تحتاجها؟**
- ✅ **نعم** - إذا ظهر لك خطأ "غير مصرح" عند فتح `/admin/users`
- ❌ **لا** - إذا تستطيع فتح الصفحة بدون مشاكل

**التنفيذ:**
1. افتح: https://supabase.com/dashboard/project/_/sql/new
2. انسخ **كل محتوى** ملف `RESTORE_AND_PROTECT_ADMIN.sql`
3. الصقه في SQL Editor
4. اضغط **Run** أو **F5**
5. انتظر رسالة النجاح: "✅ تم استرجاع صلاحيات المدير!"

**⚠️ مهم:** سجل خروج ودخول في التطبيق بعد التنفيذ!

---

## 🧪 اختبار النظام

### افتح هذه الروابط بالترتيب:

#### 1️⃣ صفحة إدارة المستخدمين:
- http://localhost:8082/admin/users
- يجب أن تفتح بدون مشاكل (إن نفذت الخطوة 2)

#### 2️⃣ صفحة إضافة مستخدم:
- http://localhost:8082/admin/add-user
- املأ البيانات:
  ```
  البريد: test@example.com
  كلمة المرور: Test123!
  الاسم: Test User
  الدور: وكيل عقاري
  ```
- اضغط "إنشاء مستخدم جديد"
- ✅ **ملاحظة**: لن تعمل حتى تنفذ الخطوة 1 (نشر Edge Function)!

#### 3️⃣ صفحة توثيق النظام:
- http://localhost:8082/system-documentation
- شاهد شرح جميع الأدوار والصلاحيات

#### 4️⃣ لوحة التحكم (تبويب الأدوار):
- http://localhost:8082/dashboard
- اضغط على تبويب "الأدوار والصلاحيات"
- جرب تغيير دور مستخدم

---

## 📊 جدول الخطوات

| الخطوة | الحالة | يدوي/تلقائي | الوقت |
|--------|--------|-------------|-------|
| تشغيل السيرفر | ✅ تم | 🤖 تلقائي | - |
| فتح المتصفح | ✅ تم | 🤖 تلقائي | - |
| نشر Edge Function | ⏳ معلق | 👤 يدوي | 5 دقائق |
| استعادة صلاحيات المدير | ⏳ معلق | 👤 يدوي | 2 دقيقة |
| اختبار النظام | ⏳ معلق | 👤 يدوي | 5 دقائق |

---

## ❓ حل المشاكل

### 🔴 خطأ: "Port 8081 is in use"
- ✅ تم الحل تلقائياً! السيرفر يعمل على **8082**
- جميع الروابط أعلاه محدثة للبورت الجديد

### 🔴 خطأ: "403 Forbidden" عند إضافة مستخدم
- **السبب**: Edge Function غير منشور
- **الحل**: نفذ الخطوة 1 أعلاه

### 🔴 خطأ: "غير مصرح" عند فتح /admin/users
- **السبب**: صلاحيات المدير غير مستعادة
- **الحل**: نفذ الخطوة 2 أعلاه

### 🔴 خطأ: "supabase: command not found"
- **الحل**: استخدم `npx` بدلاً:
  ```powershell
  npx supabase login
  npx supabase link --project-ref YOUR_ID
  npx supabase functions deploy create-user
  ```

---

## 🎯 الخلاصة

### ما تم إنجازه:
- ✅ السيرفر يعمل على http://localhost:8082
- ✅ المتصفح مفتوح
- ✅ جميع الأكواد جاهزة 100%

### ما يتبقى (منك):
1. 🔴 نشر Edge Function (5 دقائق - **إجباري**)
2. 🟡 استعادة صلاحيات المدير (2 دقيقة - إن لزم)
3. 🟢 اختبار النظام (5 دقائق)

**الوقت الكلي**: 10-15 دقيقة فقط! ⏱️

---

## 🚀 ابدأ الآن

افتح PowerShell جديد ونفذ:
```powershell
npm install -g supabase
supabase login
```

ثم اتبع الخطوة 1 أعلاه! 💪

---

**السيرفر يعمل الآن**: http://localhost:8082 🎉  
**ملاحظة**: لا تغلق نافذة PowerShell التي تشغل السيرفر!
