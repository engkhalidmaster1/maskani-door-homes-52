# ูุธุงู ุงุฎุชูุงุฑ ุงููุญุงูุธุฉ ูุงูุชุดุงู ุงููููุน ุงูุฌุบุฑุงูู

## ๐ ุงูููุฎุต
ุชู ุฅุถุงูุฉ ูุธุงู ูุงูู ูุงุฎุชูุงุฑ ุงููุญุงูุธุฉ (ุฃุฑุจููุ ุฏูููุ ุณูููุงููุฉ) ูุน ุงูุชุญูู ุงูุฌุบุฑุงูู ูู ุงููููุน ุนูู ุงูุฎุฑูุทุฉ.

---

## โ ุงูุชุบููุฑุงุช ุงููููุฐุฉ

### 1๏ธโฃ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Migration)
**ุงูููู**: `supabase/migrations/20251120233000_add_governorate_field.sql`

- โ ุฅุถุงูุฉ ุนููุฏ `governorate` ุฅูู ุฌุฏูู `properties`
- โ ุงูููู ุงููุณููุญุฉ: `'erbil'`, `'duhok'`, `'sulaymaniyah'`
- โ ุงูุญูู **ุฅูุฒุงูู** (ุชู ุชุญุฏูุซู ูู ุฏุงูุฉ validation)
- โ ุฅูุดุงุก index ููุจุญุซ ุงูุณุฑูุน
-  โ ุชุญุฏูุซ `property_validation_core` ููุชุญูู ูู ุงููุญุงูุธุฉ

### 2๏ธโฃ ูููู ุงุฎุชูุงุฑ ุงููุญุงูุธุฉ
**ุงูููู**: `src/components/Property/AddProperty/GovernorateSection.tsx`

**ุงููููุฒุงุช**:
- ๐จ ูุงุฌูุฉ ุฌูููุฉ ูุน 3 ุฃุฒุฑุงุฑ ูุจูุฑุฉ
- ๐ฏ ูู ูุญุงูุธุฉ ููุง ููู ูููุฒ:
  - ุฃุฑุจูู: ุฃุฒุฑู/ุจููุณุฌู ๐๏ธ
  - ุฏููู: ุฃุฎุถุฑ/ุฒูุฑุฏู โฐ๏ธ
  - ุณูููุงููุฉ: ุจููุณุฌู/ูุฑุฏู ๐๏ธ
- โจ ุชุฃุซูุฑุงุช ุญุฑูุฉ ุนูุฏ ุงูุงุฎุชูุงุฑ
- โ ุฑุณุงูุฉ ุชุฃููุฏ ุจุนุฏ ุงูุงุฎุชูุงุฑ

**ุงูุญุฏูุฏ ุงูุฌุบุฑุงููุฉ** (Bounding Boxes):
```typescript
erbil: {
  north: 36.65, south: 35.75,
  east: 44.50, west: 43.55
}
duhok: {
  north: 37.35, south: 36.40,
  east: 43.50, west: 42.50
}
sulaymaniyah: {
  north: 36.00, south: 35.10,
  east: 45.90, west: 44.95
}
```

**ุงูุฏูุงู ุงููุณุงุนุฏุฉ**:
- `isLocationInGovernorate(lat, lng, governorate)` - ุงูุชุญูู ูู ุงููููุน
- `getGovernorateName(governorate)` - ุงูุญุตูู ุนูู ุงูุงุณู ุจุงูุนุฑุจูุฉ

### 3๏ธโฃ ุชุญุฏูุซ ูููุฐุฌ ุฅุถุงูุฉ ุงูุนูุงุฑ
**ุงููููุงุช ุงููุนุฏูุฉ**:
- `src/pages/AddProperty.tsx` - ุฅุถุงูุฉ GovernorateSection
- `src/hooks/useAddPropertyForm.ts`:
  - ุฅุถุงูุฉ `governorate: ""` ุฅูู initialFormData
  - ุฅุถุงูุฉ `governorate` ุฅูู propertyData ุนูุฏ ุงูุญูุธ

---

##  ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงููุทููุจุฉ

### 1. ุชุทุจูู Migration ูู Supabase
**ุงูุชุญ**: https://supabase.com/dashboard โ SQL Editor

**ููุฐ ุงูููุฏ**:
```sql
-- ุงูุณุฎ ูุญุชูู ููู:
-- supabase/migrations/20251120233000_add_governorate_field.sql
```

### 2. ุชุญุฏูุซ MapPicker ููุชุญูู ูู ุงูุญุฏูุฏ
**ุงูููู ุงููุทููุจ ุชุนุฏููู**: `src/components/Map/MapPicker.tsx`

**ุงูุชุนุฏููุงุช ุงููุทููุจุฉ**:
```tsx
import { isLocationInGovernorate, getGovernorateName } from '@/components/Property/AddProperty/GovernorateSection';

// ูู handleLocationSelect:
const handleLocationSelect = (lat: number, lng: number) => {
  // ุงูุชุญูู ูู ุงููุญุงูุธุฉ ุงููุฎุชุงุฑุฉ
  const governorate = formData.governorate;
  
  if (!governorate) {
    toast({
      title: "โ๏ธ ูุฑุฌู ุงุฎุชูุงุฑ ุงููุญุงูุธุฉ ุฃููุงู",
      description: "ุงุฎุชุฑ ุงููุญุงูุธุฉ ูุจู ุชุญุฏูุฏ ุงููููุน ุนูู ุงูุฎุฑูุทุฉ",
      variant: "destructive"
    });
    return;
  }
  
  // ุงูุชุญูู ูู ุฃู ุงููููุน ุถูู ุญุฏูุฏ ุงููุญุงูุธุฉ
  if (!isLocationInGovernorate(lat, lng, governorate)) {
    toast({
      title: "โ ุงููููุน ุฎุงุฑุฌ ุญุฏูุฏ " + getGovernorateName(governorate),
      description: "ูุฑุฌู ุงุฎุชูุงุฑ ูููุน ุฏุงุฎู ุญุฏูุฏ ุงููุญุงูุธุฉ ุงููุญุฏุฏุฉ",
      variant: "destructive"
    });
    return;
  }
  
  // ุฅุฐุง ูุงู ุงููููุน ุตุญูุญุ ุชุงุจุน
  onLocationSelect(lat, lng);
  toast({
    title: "โ ุชู ุชุญุฏูุฏ ุงููููุน",
    description: `ุงููููุน ุฏุงุฎู ุญุฏูุฏ ${getGovernorateName(governorate)}`,
  });
};
```

### 3. ุชุญุฏูุซ Supabase Types
**ุงูููู**: `src/integrations/supabase/types.ts`

**ุฅุถุงูุฉ** `governorate` ุฅูู ููุน Properties:
```typescript
export interface Properties {
  // ... ุงูุญููู ุงูููุฌูุฏุฉ
  governorate?: string | null;
  // ...
}
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### ุณููุงุฑูู 1: ุงุฎุชูุงุฑ ุฃุฑุจูู
1. ุงุฎุชุฑ "ุฃุฑุจูู" ูู ุงููุงุฆูุฉ
2. ุนูู ุงูุฎุฑูุทุฉุ ุญุฏุฏ ูููุน ูู ุฃุฑุจูู (ูุซู: 36.19, 44.01)
3. โ ูุฌุจ ุฃู ููุฌุญ

### ุณููุงุฑูู 2: ูุญุงููุฉ ุงุฎุชูุงุฑ ูููุน ุฎุงุทุฆ
1. ุงุฎุชุฑ "ุฏููู"
2. ุญุงูู ุชุญุฏูุฏ ูููุน ูู ุฃุฑุจูู (36.19, 44.01)
3. โ ูุฌุจ ุฃู ูููุนู ูุน ุฑุณุงูุฉ ุฎุทุฃ

### ุณููุงุฑูู 3: ุนุฏู ุงุฎุชูุงุฑ ูุญุงูุธุฉ
1. ูุง ุชุฎุชุฑ ุฃู ูุญุงูุธุฉ
2. ุญุงูู ุชุญุฏูุฏ ูููุน ุนูู ุงูุฎุฑูุทุฉ
3. โ๏ธ ูุฌุจ ุฃู ูุทูุจ ููู ุงุฎุชูุงุฑ ุงููุญุงูุธุฉ ุฃููุงู

---

## ๐ ุชุฑุชูุจ ุงูุญููู ูู ุงููููุฐุฌ

1. **ุนููุงู ุงูุนูุงุฑ** - BasicInfoSection
2. **๐ ุงุฎุชูุงุฑ ุงููุญุงูุธุฉ** - GovernorateSection โญ
3. **ููุน ุงูุนูุงุฑ** - PropertyTypeSection
4. **ุชูุงุตูู ุงูุนูุงุฑ** - PropertyDetailsSection
5. ุงูุจููุฉ...

---

## ๐ ุงูุชุญูู ูู ุงูุจูุงูุงุช (Validation)

### ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- โ `governorate` ูุทููุจ (NOT NULL after migration)
- โ ุงูููู ุงููุณููุญุฉ ููุท: erbil, duhok, sulaymaniyah
- โ CHECK constraint ููุชุฃูุฏ

### ุนูู ูุณุชูู ุงูุชุทุจูู:
- โ UI ูุง ูุณูุญ ุจุฅุฑุณุงู ุงููููุฐุฌ ุจุฏูู ุงุฎุชูุงุฑ ูุญุงูุธุฉ
- โณ **ูุทููุจ**: ุฅุถุงูุฉ ุงูุชุญูู ุงูุฌุบุฑุงูู ูู MapPicker
- โณ **ูุทููุจ**: ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงููููุน ุงูุงูุชุฑุงุถู ุนูู ุงูุฎุฑูุทุฉ**: 
   - ุนูุฏ ุงุฎุชูุงุฑ ูุญุงูุธุฉุ ูุฌุจ ุชุญุฑูู ุงูุฎุฑูุทุฉ ุฅูู ูุฑูุฒ ุชูู ุงููุญุงูุธุฉ
   
2. **ุญูุธ ุงูุจูุงูุงุช ุงููุฏููุฉ**:
   - ุงูุนูุงุฑุงุช ุงููุฏููุฉ ุงูุชู ููุณ ููุง `governorate` ุณุชููู NULL
   - ูุฌุจ ุชุญุฏูุซูุง ูุฏููุงู ุฃู ุชุฑุญูููุง

3. **ุงูุจุญุซ ูุงูููุชุฑุฉ**:
   - ูููู ุงูุขู ุงูุจุญุซ/ููุชุฑุฉ ุงูุนูุงุฑุงุช ุญุณุจ ุงููุญุงูุธุฉ
   - ุชู ุฅุถุงูุฉ index ููุฃุฏุงุก

---

## โจ ุงููููุฒุงุช

- โ ูุงุฌูุฉ ูุณุชุฎุฏู ุฌูููุฉ ูุณููุฉ
- โ ุงูุชุญูู ุงูุฌุบุฑุงูู ุงูุฏููู
- โ ููุน ุงูุฃุฎุทุงุก ูุจู ุงูุญูุธ
- โ ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู
- โ ุฃุฏุงุก ุนุงูู ูุน indexing
- โ ุฏุนู ูุงูู ููุบุฉ ุงูุนุฑุจูุฉ

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-11-20  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุชุทุจูู
