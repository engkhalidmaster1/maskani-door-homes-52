# ๐ง ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุฑูุน ุงูุตูุฑ ุนูุฏ ุฅุถุงูุฉ ุนูุงุฑ

## โ ุงูุชุญุฏูุซุงุช ุงูููููุฐุฉ

### 1. ุชุญุณูู ุฏุงูุฉ ุฑูุน ุงูุตูุฑ (`useAddPropertyForm.ts`)

**ุงููุดููุฉ ุงูุฃุตููุฉ:**
- ูุงูุช ุฏุงูุฉ `uploadImages` ุชุนูุฏ ูุตูููุฉ ูุงุฑุบุฉ `[]` ูู ุญุงูุฉ ุงููุดู
- ูู ููู ููุงู ุชุญูู ูู ูุฌูุฏ ุตูุฑ ูุจู ูุญุงููุฉ ุฅุถุงูุฉ ุงูุนูุงุฑ
- ูุงู ูุชู ุฅุถุงูุฉ ุงูุนูุงุฑ ุจูุฌุงุญ **ุจุฏูู ุตูุฑ** ุนูุฏ ูุดู ุงูุฑูุน

**ุงูุฅุตูุงุญุงุช ุงูููุทุจูุฉ:**

#### ุฃ) ุชุญุณูู ุฏุงูุฉ `uploadImages`:
```typescript
const uploadImages = useCallback(async (): Promise<string[]> => {
  // โ ุฅูุฒุงููุฉ ูุฌูุฏ ุตูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู
  if (selectedImages.length === 0) {
    throw new Error('ูุฌุจ ุฅุถุงูุฉ ุตูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ููุนูุงุฑ');
  }
  
  try {
    const uploadedUrls = await uploadOptimizedImages(selectedImages, 'property-images');
    
    // โ ุงูุชุฃูุฏ ูู ูุฌุงุญ ุฑูุน ุฌููุน ุงูุตูุฑ
    if (uploadedUrls.length === 0) {
      throw new Error('ูุดู ุฑูุน ุงูุตูุฑ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู');
    }
    
    // โ๏ธ ุชุญุฐูุฑ ุฅุฐุง ุชู ุฑูุน ุจุนุถ ุงูุตูุฑ ููุท
    if (uploadedUrls.length < selectedImages.length) {
      const failedCount = selectedImages.length - uploadedUrls.length;
      console.warn(`ุชุญุฐูุฑ: ูุดู ุฑูุน ${failedCount} ูู ${selectedImages.length} ุตูุฑุฉ`);
    }
    
    return uploadedUrls;
  } catch (error) {
    console.error('Error uploading optimized images:', error);
    throw new Error(error instanceof Error ? error.message : 'ูุดู ุฑูุน ุงูุตูุฑ');
  }
}, [selectedImages, uploadOptimizedImages]);
```

#### ุจ) ุฅุถุงูุฉ ุงูุชุญูู ูู ุงูุตูุฑ ูู `handleSubmit`:
```typescript
// โ ุงูุชุญูู ูู ูุฌูุฏ ุตูุฑ ูุจู ุงูุฅุฑุณุงู
if (selectedImages.length === 0) {
  toast({
    title: "ูุฌุจ ุฅุถุงูุฉ ุตูุฑุฉ",
    description: "ูุฑุฌู ุฅุถุงูุฉ ุตูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ููุนูุงุฑ",
    variant: "destructive",
  });
  return;
}
```

### 2. ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู `useOptimizedImageUpload.tsx`

**ุงูุชุญุณููุงุช:**
- ุฅุถุงูุฉ ุฑุณุงุฆู ุฎุทุฃ ุชูุตูููุฉ ููู ุตูุฑุฉ ูุดูุช
- ุงูุชุญูู ูู ุฅุฑุฌุงุน `data` ูู Supabase
- ุนุฑุถ ุฅุดุนุงุฑุงุช toast ููุฃุฎุทุงุก ุงููุฑุฏูุฉ

```typescript
if (error) {
  console.error(`ุฎุทุฃ ูู ุฑูุน ุงูุตูุฑุฉ ${file.name}:`, error);
  setUploadProgress(prev => prev.map((item, index) => 
    index === i ? { ...item, status: 'error', error: error.message } : item
  ));
  toast({
    title: `ูุดู ุฑูุน ${file.name}`,
    description: error.message,
    variant: "destructive",
  });
  continue;
}

if (!data) {
  console.error(`ูู ูุชู ุฅุฑุฌุงุน ุจูุงูุงุช ูู Supabase ููุตูุฑุฉ ${file.name}`);
  setUploadProgress(prev => prev.map((item, index) => 
    index === i ? { ...item, status: 'error', error: 'ูู ูุชู ุฅุฑุฌุงุน ุจูุงูุงุช' } : item
  ));
  continue;
}
```

## ๐ ุฎุทูุงุช ุงูุชุญูู ูู Supabase

### 1. ุงูุชุฃูุฏ ูู ูุฌูุฏ Storage Bucket

ุงุฐูุจ ุฅูู Supabase Dashboard โ Storage ูุชุญูู ูู:

โ **Bucket Name:** `property-images`
โ **Public Access:** ูููุนูู (Public)
โ **File Size Limit:** 5MB
โ **Allowed MIME Types:** 
   - image/jpeg
   - image/jpg
   - image/png
   - image/webp
   - image/gif

### 2. ุชุทุจูู ุณูุงุณุงุช ุงูุฃูุงู (Policies)

ูู Supabase SQL Editorุ ุดุบูู ุงูููุฏ ุงูุชุงูู:

```sql
-- ุงูุณูุงุญ ุจุฑูุน ุงูุตูุฑ ูููุณุชุฎุฏููู ุงููุณุฌููู
CREATE POLICY "Allow authenticated users to upload images"
ON storage.objects
FOR INSERT
TO authenticated
WITH CHECK (bucket_id = 'property-images');

-- ุงูุณูุงุญ ุจูุฑุงุกุฉ ุงูุตูุฑ ููุฌููุน
CREATE POLICY "Allow public to read images"
ON storage.objects
FOR SELECT
TO public
USING (bucket_id = 'property-images');
```

### 3. ุฅูุดุงุก Bucket ุฅุฐุง ูู ููู ููุฌูุฏุงู

```sql
INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
VALUES (
  'property-images',
  'property-images',
  true,
  5242880,
  ARRAY['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif']
)
ON CONFLICT (id) DO UPDATE
SET 
  public = true,
  file_size_limit = 5242880,
  allowed_mime_types = ARRAY['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];
```

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### ุงูุณููุงุฑูู 1: ูุญุงููุฉ ุฅุถุงูุฉ ุนูุงุฑ ุจุฏูู ุตูุฑ
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ ุฑุณุงูุฉ ุฎุทุฃ: "ูุฌุจ ุฅุถุงูุฉ ุตูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ููุนูุงุฑ"

### ุงูุณููุงุฑูู 2: ุฅุถุงูุฉ ุตูุฑ ุซู ุฅุถุงูุฉ ุงูุนูุงุฑ
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** 
- โ ูุชู ุฑูุน ุงูุตูุฑ ุจูุฌุงุญ
- โ ูุชู ุฅุถุงูุฉ ุงูุนูุงุฑ ูุน ุงูุตูุฑ
- โ ุฑุณุงูุฉ ูุฌุงุญ: "ุชู ุฅุถุงูุฉ ุงูุนูุงุฑ ูุน X ุตูุฑุฉ"

### ุงูุณููุงุฑูู 3: ูุดู ุฑูุน ุงูุตูุฑ (ูุดููุฉ ูู ุงูุงุชุตุงู)
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** 
- โ ุฑุณุงูุฉ ุฎุทุฃ: "ูุดู ุฑูุน ุงูุตูุฑ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู"
- โ ูุง ูุชู ุฅุถุงูุฉ ุงูุนูุงุฑ

## ๐ ุงูุชุญูู ูู ุงููุดููุฉ

ุงูุชุญ Console ูู ุงููุชุตูุญ (F12) ูุฑุงูุจ:

1. **ุนูุฏ ุงุฎุชูุงุฑ ุงูุตูุฑ:**
```
โ ุชู ุฅุถุงูุฉ ุงูุตูุฑ
โ ุชู ุฅุถุงูุฉ X ุตูุฑุฉ
```

2. **ุนูุฏ ุงูุถุบุท ุนูู "ูุดุฑ ุงูุนูุงุฑ":**
```
Optimizing image: filename.jpg
Uploading image: filename.jpg
โ ุชู ุฑูุน ุงูุตูุฑ ุจูุฌุงุญ
```

3. **ูู ุญุงูุฉ ุงูุฎุทุฃ:**
```
โ ุฎุทุฃ ูู ุฑูุน ุงูุตูุฑุฉ filename.jpg: [error message]
โ Error uploading optimized images: [error]
```

## ๐๏ธ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ุงููุดููุฉ: "Access denied to bucket property-images"
**ุงูุญู:** ุชุฃูุฏ ูู ุณูุงุณุงุช ุงูุฃูุงู ูู Supabase Storage

### ุงููุดููุฉ: "File size exceeds limit"
**ุงูุญู:** ุงูุตูุฑุฉ ุฃูุจุฑ ูู 5MBุ ุณูุชู ุถุบุทูุง ุชููุงุฆูุงู ุฅูู ุฃูู ูู 5MB

### ุงููุดููุฉ: "Invalid mime type"
**ุงูุญู:** ููุท ุงูุตูุฑ ูุฏุนููุฉ (JPEG, PNG, WebP, GIF)

### ุงููุดููุฉ: ุชู ุฑูุน ุจุนุถ ุงูุตูุฑ ููุท
**ุงูุญู:** ุฑุงุฌุน Console ููุฃุฎุทุงุก ุงูุชูุตูููุฉุ ูุฏ ุชููู ุจุนุถ ุงูุตูุฑ ุชุงููุฉ

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

1. โ **ุฅุฌุจุงุฑูุฉ ุงูุตูุฑ:** ูุง ูููู ุฅุถุงูุฉ ุนูุงุฑ ุจุฏูู ุตูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู
2. โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณููุฉ:** ุฑุณุงุฆู ูุงุถุญุฉ ุนูุฏ ูุดู ุฑูุน ุงูุตูุฑ
3. โ **ุชุชุจุน ุงูุชูุฏู:** ููููู ุฑุคูุฉ ุชูุฏู ุฑูุน ูู ุตูุฑุฉ
4. โ **ุชุญุฐูุฑุงุช:** ุฅุดุนุงุฑ ุฅุฐุง ูุดู ุฑูุน ุจุนุถ ุงูุตูุฑ
5. โ **ุชุญุณูู ุงูุฃุฏุงุก:** ุถุบุท ุงูุตูุฑ ุชููุงุฆูุงู ูุจู ุงูุฑูุน

## ๐ ููุงุญุธุงุช ูููุฉ

- **ุญุฏ ุงูุตูุฑ:** ูุนุชูุฏ ุนูู ููุน ุงูุญุณุงุจ (`images_limit` ูู `user_status`)
- **ุญุฌู ุงูุตูุฑุฉ:** ูุงูุณ 5MB ููุตูุฑุฉ ุงููุงุญุฏุฉ (ูุชู ุงูุถุบุท ุชููุงุฆูุงู)
- **ุฌูุฏุฉ ุงูุถุบุท:** 85% (ุชูุงุฒู ุจูู ุงูุญุฌู ูุงูุฌูุฏุฉ)
- **ุฃุจุนุงุฏ ุงูุตูุฑุฉ:** ูุงูุณ 1200ร900 ุจูุณู

---

## ๐ฏ ุงูุฎูุงุตุฉ

**ูุจู ุงูุชุญุฏูุซ:** ูุงู ููุถุงู ุงูุนูุงุฑ ุจุฏูู ุตูุฑ ุนูุฏ ูุดู ุงูุฑูุน โ
**ุจุนุฏ ุงูุชุญุฏูุซ:** ูุง ูููู ุฅุถุงูุฉ ุนูุงุฑ ุจุฏูู ุตูุฑ ุฃุจุฏุงู โ

ุฌููุน ุงูุฅุตูุงุญุงุช ุชูุช ุชููุงุฆูุงู! ููุท ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช Supabase Storage.
