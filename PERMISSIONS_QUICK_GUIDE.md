# ğŸ¯ Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹: Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙÙŠ Maskani

> **Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** 17 Ø£ÙƒØªÙˆØ¨Ø± 2025

---

## ğŸ“Œ Ù†Ø¸Ø§Ù…Ø§Ù† Ù…Ù†ÙØµÙ„Ø§Ù†

### 1ï¸âƒ£ `user_roles` - Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø§Ù„Ø¯ÙˆØ±   â”‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ admin   â”‚ âœ… ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©        â”‚
â”‚ user    â”‚ âšª ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2ï¸âƒ£ `user_statuses` - Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø§Ù„Ø­Ø§Ù„Ø©       â”‚ Ø¹Ù‚Ø§Ø±Ø§Øª â”‚ ØµÙˆØ±    â”‚ Ù…ÙˆØ«ÙˆÙ‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ publisher    â”‚    1    â”‚    2    â”‚    âŒ    â”‚
â”‚ trusted_ownerâ”‚    5    â”‚    5    â”‚    âœ…    â”‚
â”‚ office_agent â”‚   999   â”‚    7    â”‚    âœ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ÙƒÙŠÙÙŠØ© ÙØ­Øµ ØµÙ„Ø§Ø­ÙŠØ§ØªÙƒ

### ÙÙŠ Supabase SQL Editor:
```sql
-- Ø§Ø³ØªØ¨Ø¯Ù„ YOUR_EMAIL Ø¨Ø¥ÙŠÙ…ÙŠÙ„Ùƒ
SELECT 
  au.email,
  ur.role as admin_role,
  us.status as account_type,
  us.properties_limit,
  us.can_publish,
  COUNT(p.id) as current_properties
FROM auth.users au
LEFT JOIN user_roles ur ON au.id = ur.user_id
LEFT JOIN user_statuses us ON au.id = us.user_id
LEFT JOIN properties p ON au.id = p.user_id
WHERE au.email = 'YOUR_EMAIL'
GROUP BY au.email, ur.role, us.status, us.properties_limit, us.can_publish;
```

### ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (F12 Console):
```javascript
// ÙŠØ¬Ø¨ Ø£Ù† ØªØ±Ù‰:
// isAdmin: true  (Ø¥Ø°Ø§ ÙƒÙ†Øª Ù…Ø¯ÙŠØ±)
// userRole: "admin" Ø£Ùˆ "user"
```

---

## ğŸ› ï¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©

### âœ… Ø¬Ø¹Ù„ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¯ÙŠØ±Ø§Ù‹:
```sql
-- Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯
INSERT INTO user_roles (user_id, role)
VALUES ('user-uuid-here', 'admin');

-- Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¬ÙˆØ¯
UPDATE user_roles 
SET role = 'admin' 
WHERE user_id = 'user-uuid-here';
```

### âœ… ØªØ±Ù‚ÙŠØ© Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù…Ø§Ù„Ùƒ Ù…ÙˆØ«ÙˆÙ‚:
```sql
UPDATE user_statuses 
SET 
  status = 'trusted_owner',
  properties_limit = 5,
  images_limit = 5,
  is_verified = true,
  verified_by = 'admin-uuid',
  verified_at = now()
WHERE user_id = 'user-uuid-here';
```

### âœ… Ø­Ø¸Ø± Ù…Ø³ØªØ®Ø¯Ù…:
```sql
UPDATE user_statuses 
SET can_publish = false 
WHERE user_id = 'user-uuid-here';
```

### âœ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±:
```sql
UPDATE user_statuses 
SET can_publish = true 
WHERE user_id = 'user-uuid-here';
```

---

## ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©

```sql
-- Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
SELECT COUNT(*) FROM user_roles WHERE role = 'admin';

-- Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†
SELECT COUNT(*) FROM user_statuses WHERE can_publish = false;

-- Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ÙŠÙ†
SELECT COUNT(*) FROM user_statuses WHERE is_verified = true;

-- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª
SELECT status, COUNT(*) 
FROM user_statuses 
GROUP BY status;
```

---

## âš ï¸ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©

1. **Ø§Ø²Ø¯ÙˆØ§Ø¬ÙŠØ©**: Ù†Ø¸Ø§Ù…Ø§Ù† Ù…Ù†ÙØµÙ„Ø§Ù† ÙŠØªØ·Ù„Ø¨Ø§Ù† JOIN
2. **Ø§Ù„ØªØ¹Ù‚ÙŠØ¯**: ØµØ¹ÙˆØ¨Ø© ØªØªØ¨Ø¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ù† Ù…ÙƒØ§Ù†ÙŠÙ†
3. **Ø¹Ø¯Ù… Ø§Ù„Ù…Ø±ÙˆÙ†Ø©**: Ø­Ø¯ÙˆØ¯ Ø«Ø§Ø¨ØªØ© Ù„ÙƒÙ„ Ø­Ø§Ù„Ø©
4. **Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª**: ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø¬Ø§Ù†Ø§Ù‹

---

## ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª

### Ø¹Ø§Ø¬Ù„:
- âœ… ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ÙŠÙ† ÙÙŠ Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ø­Ø¯
- âœ… Ø¥Ø¶Ø§ÙØ© Audit Logging

### Ù‚Ø±ÙŠØ¨:
- âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
- âœ… ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£ÙƒØ«Ø± Ø¯Ù‚Ø©

### Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹:
- âœ… Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª/Ø§Ù„ÙØ±Ù‚
- âœ… API Keys Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†

---

## ğŸ“š Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø©

- `PERMISSIONS_SYSTEM_ANALYSIS.md` - ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ ÙˆÙ…ÙØµÙ„
- `TEST_PERMISSIONS.sql` - Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª ÙØ­Øµ Ø´Ø§Ù…Ù„Ø©
- `MAKE_ADMIN.sql` - ÙƒÙŠÙÙŠØ© Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠØ±
- `src/hooks/useAuth.tsx` - Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
- `src/pages/UsersView.tsx` - ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†

---

## ğŸ†˜ Ù…Ø´ÙƒÙ„Ø© Ø´Ø§Ø¦Ø¹Ø©

**Ø§Ù„Ø³Ø¤Ø§Ù„:** Ù„Ù…Ø§Ø°Ø§ ÙŠØ¸Ù‡Ø± "Ø¯ÙˆØ±Ùƒ: admin" ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„ÙƒÙ† "Ø§Ù„Ø¯ÙˆØ±: user" ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©ØŸ

**Ø§Ù„Ø¬ÙˆØ§Ø¨:** 
- "Ø¯ÙˆØ±Ùƒ: admin" â† Ù…Ù† `useAuth()` ÙŠÙ‚Ø±Ø£ `user_roles.role`
- "Ø§Ù„Ø¯ÙˆØ±: user" â† Ù…Ù† Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªÙ‚Ø±Ø£ `user_roles.role` Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
- Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙ†Ø¸Ø± Ù„Ù…Ù„Ù Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø±ØŒ Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡ Ù‡Ùˆ ÙˆÙ„ÙŠØ³ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ

**Ø§Ù„Ø­Ù„:** Ø§ÙØªØ­ console ÙˆØ´Ø§Ù‡Ø¯:
```javascript
console.log('My role:', userRole, 'isAdmin:', isAdmin);
```

---

âœ… **Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ ÙˆÙ…ÙØµÙ„ØŒ Ø±Ø§Ø¬Ø¹:** `PERMISSIONS_SYSTEM_ANALYSIS.md`
