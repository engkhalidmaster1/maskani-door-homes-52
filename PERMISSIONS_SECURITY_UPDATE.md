# ุชุญุณููุงุช ูุธุงู ุงูุตูุงุญูุงุช ูุงูุฃูุงู - ุณููู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ูุงูุฃูุงู ูู ุชุทุจูู ุณูููุ ูุดูู:

- โ ูุญุต ุตูุงุญูุงุช ููููุฉ ุงูุนูุงุฑุงุช
- โ ุชุณุฌูู ุงูุนูููุงุช ุงููููุฉ (Audit Logging)
- โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- โ ููููุงุช ูุญููุฉ ููุนูููุงุช ุงูุญุณุงุณุฉ

## ๐ง ุงูููููุงุช ุงูุฌุฏูุฏุฉ

### 1. usePropertyPermissions Hook
```typescript
const { canEdit, canDelete, canView, isOwner, isLoading } = usePropertyPermissions(propertyId);
```

**ุงููุธุงุฆู:**
- ูุญุต ููููุฉ ุงูุนูุงุฑ
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุชุนุฏูู ูุงูุญุฐู ูุงูุนุฑุถ
- ุฏุนู ุตูุงุญูุงุช ุงููุฏุฑุงุก
- ูุนุงูุฌุฉ ุญุงูุงุช ุงูุชุญููู ูุงูุฃุฎุทุงุก

### 2. useAuditLog Hook
```typescript
const { logPropertyAction, logAuthAction, logUserAction } = useAuditLog();
```

**ุงููุธุงุฆู:**
- ุชุณุฌูู ุนูููุงุช ุงูุนูุงุฑุงุช (ุฅูุดุงุกุ ุชุนุฏููุ ุญุฐูุ ุนุฑุถ)
- ุชุณุฌูู ุนูููุงุช ุงููุตุงุฏูุฉ (ุฏุฎููุ ุฎุฑูุฌ)
- ุชุณุฌูู ุนูููุงุช ุงููุณุชุฎุฏููู ูุงูุฅุฏุงุฑุฉ
- ุญูุธ ุชูุงุตูู ุงูุนูููุงุช ูุน ุงูููุช ูุงููุณุชุฎุฏู

### 3. ProtectedPropertyAction Component
```typescript
<ProtectedPropertyAction
  propertyId={id}
  action="edit"
  onAction={handleEdit}
>
  ุชุนุฏูู ุงูุนูุงุฑ
</ProtectedPropertyAction>
```

**ุงููุธุงุฆู:**
- ุฅุฎูุงุก/ุฅุธูุงุฑ ุงูุฃุฒุฑุงุฑ ุจูุงุกู ุนูู ุงูุตูุงุญูุงุช
- ุนุฑุถ ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู
- ุฏุนู ุนูููุงุช ูุฎุชููุฉ (edit, delete, view)

### 4. PropertyPermissionGuard Component
```typescript
<PropertyPermissionGuard propertyId={id} action="edit">
  <EditForm />
</PropertyPermissionGuard>
```

**ุงููุธุงุฆู:**
- ุญูุงูุฉ ุฃุฌุฒุงุก ูุงููุฉ ูู ุงููุงุฌูุฉ
- ุนุฑุถ ูุญุชูู ุจุฏูู ุนูุฏ ุนุฏู ูุฌูุฏ ุตูุงุญูุฉ
- ุฏุนู ุญุงูุงุช ุงูุชุญููู

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู audit_logs
```sql
-- ุงูุนููุฏ ุงูุฃุณุงุณู
id UUID PRIMARY KEY
user_id UUID REFERENCES auth.users(id)
action TEXT CHECK (action IN ('create', 'update', 'delete', 'view', 'login', 'logout'))
resource_type TEXT CHECK (resource_type IN ('property', 'user', 'banner', 'auth', 'office'))
resource_id TEXT
details JSONB
ip_address INET
user_agent TEXT
created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
```

**ุงูููุฒุงุช:**
- Row Level Security (RLS) ููุนู
- ููุงุฑุณ ูุญุณูุฉ ููุฃุฏุงุก
- Triggers ุชููุงุฆูุฉ ููุนูุงุฑุงุช
- ุฏูุงู ูุณุงุนุฏุฉ ูุฅุฏุฑุงุฌ ุงูุณุฌูุงุช

## ๐ ุชุญุณููุงุช ุงูุฃูุงู

### 1. ูุญุต ุงูููููุฉ
- ุงูุชุญูู ูู ููููุฉ ุงูุนูุงุฑ ูุจู ุงูุชุนุฏูู
- ููุน ุงูุชูุงุนุจ ุจุนูุงุฑุงุช ุงูุขุฎุฑูู
- ุฏุนู ุตูุงุญูุงุช ุงููุฏุฑุงุก ุงูุฎุงุตุฉ

### 2. ุชุณุฌูู ุงูุนูููุงุช
- ุชุณุฌูู ุฌููุน ุงูุชุบููุฑุงุช ุงููููุฉ
- ุญูุธ ุชูุงุตูู ุงูุนูููุงุช ูุน ุงูุชูููุช
- ุฅููุงููุฉ ูุฑุงุฌุนุฉ ุงูุณุฌูุงุช ูููุฏุฑุงุก

### 3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงููุญุณูุฉ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- ูุนุงูุฌุฉ ุญุงูุงุช ุงูุดุจูุฉ ูุงูุงุชุตุงู
- ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ ููุนูููุงุช

## ๐ฑ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

### ูููุงูููู
- โ ูููู ุชุนุฏูู ูุญุฐู ุนูุงุฑุงุชูู ููุท
- โ ุฑุณุงุฆู ูุงุถุญุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ุตูุงุญูุฉ
- โ ุชุฃููุฏุงุช ุนูุฏ ุงูุนูููุงุช ุงูุญุณุงุณุฉ

### ูููุฏุฑุงุก
- โ ุตูุงุญูุงุช ูุงููุฉ ุนูู ุฌููุน ุงูุนูุงุฑุงุช
- โ ุฅููุงููุฉ ูุฑุงุฌุนุฉ ุณุฌูุงุช ุงูุนูููุงุช
- โ ุฃุฏูุงุช ุฅุฏุงุฑูุฉ ูุชูุฏูุฉ

### ููุฒูุงุฑ
- โ ุนุฑุถ ุงูุนูุงุฑุงุช ุงูููุดูุฑุฉ ููุท
- โ ุฅุนุงุฏุฉ ุชูุฌูู ูุชุณุฌูู ุงูุฏุฎูู ุนูุฏ ุงูุญุงุฌุฉ
- โ ูุงุฌูุฉ ูุงุถุญุฉ ูุญุงูุงุช ุนุฏู ุงูุตูุงุญูุฉ

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชูุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# ุชุดุบูู ุงูุณูุฑูุจุช ูู Supabase
psql -f audit_logs_setup.sql
```

### 2. ุงุณุชุฎุฏุงู Hooks
```typescript
// ูู ููููุงุช React
import { usePropertyPermissions } from '@/hooks/usePropertyPermissions';
import { useAuditLog } from '@/hooks/useAuditLog';

function PropertyCard({ propertyId }) {
  const { canEdit, canDelete } = usePropertyPermissions(propertyId);
  const { logPropertyAction } = useAuditLog();
  
  const handleDelete = async () => {
    await deleteProperty(propertyId);
    await logPropertyAction('delete', propertyId);
  };
}
```

### 3. ุงุณุชุฎุฏุงู ุงูููููุงุช ุงููุญููุฉ
```typescript
import { ProtectedPropertyAction } from '@/components/ProtectedPropertyAction';

<ProtectedPropertyAction
  propertyId={property.id}
  action="delete"
  variant="destructive"
  onAction={handleDelete}
>
  ุญุฐู ุงูุนูุงุฑ
</ProtectedPropertyAction>
```

## ๐ ุฅุญุตุงุฆูุงุช ุงูุชุญุณูู

### ุงูุฃูุงู
- ๐ 100% ูู ุงูุนูุงุฑุงุช ูุญููุฉ ุจูุญุต ุงูููููุฉ
- ๐ ุชุณุฌูู ุดุงูู ูุฌููุน ุงูุนูููุงุช ุงููููุฉ
- ๐ก๏ธ Row Level Security ููุนู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฃุฏุงุก
- โก ุงุณุชุนูุงูุงุช ูุญุณูุฉ ุจููุงุฑุณ ููุงุณุจุฉ
- ๐ ุชุญููู ุชุฏุฑูุฌู ููุตูุงุญูุงุช
- ๐พ ุชุฎุฒูู ูุคูุช ููุตูุงุญูุงุช ุงููุชูุฑุฑุฉ

### ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- ๐ฑ ูุงุฌูุฉ ูุชุฌุงูุจุฉ ูุน ุฌููุน ุงูุฃุญุฌุงู
- ๐ ุฑุณุงุฆู ูุงุถุญุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- โฑ๏ธ ุชุญุฏูุซุงุช ููุฑูุฉ ูุญุงูุฉ ุงูุตูุงุญูุงุช

## ๐ง ุงูุชุทููุฑ ุงููุณุชูุจูู

### ุงููุฎุทุท
- [ ] ุฅุถุงูุฉ ุตูุงุญูุงุช ูุชุฏุฑุฌุฉ (moderator, editor)
- [ ] ูุธุงู ุฅุดุนุงุฑุงุช ููุนูููุงุช ุงููููุฉ
- [ ] ุชูุงุฑูุฑ ุชูุตูููุฉ ูุณุฌูุงุช ุงููุฑุงุฌุนุฉ
- [ ] API rate limiting ููุญูุงูุฉ ูู ุณูุก ุงูุงุณุชุฎุฏุงู

### ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ
- [ ] ุชุดููุฑ ุชูุงุตูู ุงูุนูููุงุช ุงูุญุณุงุณุฉ
- [ ] ูุธุงู ูุณุฎ ุงุญุชูุงุทู ูุณุฌูุงุช ุงููุฑุงุฌุนุฉ
- [ ] ูุงุฌูุฉ ุฅุฏุงุฑูุฉ ููุฑุงุฌุนุฉ ุงูุณุฌูุงุช
- [ ] ุชูุจููุงุช ุชููุงุฆูุฉ ููุนูููุงุช ุงููุดุจููุฉ

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุงุณุชูุณุงุฑุงุช ุญูู ูุธุงู ุงูุตูุงุญูุงุช:
- ๐ง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: support@sakani.app
- ๐ฌ ุงูุฏุฑุฏุดุฉ ุงููุจุงุดุฑุฉ: ูุชููุฑุฉ ูู ุงูุชุทุจูู
- ๐ฑ ุงููุงุชู: 00905013196750

---

*ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ูุถูุงู ุฃุนูู ูุณุชููุงุช ุงูุฃูุงู ูุณูููุฉ ุงูุงุณุชุฎุฏุงู ูู ุชุทุจูู ุณููู*