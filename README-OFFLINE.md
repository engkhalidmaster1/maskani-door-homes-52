# مسكني - تطبيق العقارات مع التزامن الذكي

## ✨ الميزات الجديدة - التزامن الذكي

تم تطوير تطبيق مسكني ليدعم **التزامن الذكي** الذي يتيح للتطبيق العمل بكفاءة مع وجود الإنترنت وبدونه.

### 🌐 المزايا الرئيسية

#### 1. العمل دون اتصال (Offline-First)
- **حفظ محلي للبيانات**: جميع التغييرات تحفظ محلياً فوراً
- **مزامنة تلقائية**: عند عودة الاتصال، تتم المزامنة تلقائياً
- **تجربة سلسة**: لا توقف في العمل حتى مع انقطاع الإنترنت

#### 2. مؤشرات الحالة الذكية
- **مؤشر الاتصال**: عرض حالة الاتصال بالإنترنت
- **قائمة الأعمال المعلقة**: عرض العمليات في انتظار المزامنة
- **إشعارات تفاعلية**: تنبيهات عند تغيير حالة الاتصال

#### 3. تخزين محلي متقدم
- **IndexedDB**: تخزين آمن وسريع للبيانات
- **Service Worker**: تخزين مؤقت ذكي للملفات
- **إدارة التخزين**: تنظيف تلقائي للبيانات القديمة

### 🛠️ التقنيات المستخدمة

#### Frontend Technologies
- **React 18** - مكتبة واجهة المستخدم
- **TypeScript** - لغة برمجة محسنة مع أنواع البيانات
- **Vite** - أداة بناء سريعة
- **Tailwind CSS** - إطار عمل للتصميم
- **Electron** - لتطبيق سطح المكتب

#### Offline Technologies
- **Service Worker** - للتحكم في التخزين المؤقت والمزامنة
- **IndexedDB** - قاعدة بيانات محلية في المتصفح
- **Background Sync** - مزامنة في الخلفية
- **Cache API** - تخزين مؤقت للموارد

#### Backend & Database
- **Supabase** - قاعدة بيانات وخدمات الخلفية
- **PostgreSQL** - قاعدة البيانات الرئيسية
- **Real-time subscriptions** - التحديثات الفورية

### 📱 كيفية العمل

#### 1. مع الاتصال بالإنترنت
```
المستخدم → التطبيق → قاعدة البيانات المحلية → الخادم
                     ↓
                 تأكيد فوري ← مزامنة تلقائية
```

#### 2. بدون اتصال بالإنترنت
```
المستخدم → التطبيق → قاعدة البيانات المحلية
                     ↓
                 حفظ محلي → قائمة الأعمال المعلقة
```

#### 3. عند عودة الاتصال
```
قائمة الأعمال المعلقة → معالجة تلقائية → مزامنة مع الخادم
                                        ↓
                                    تنظيف القائمة
```

### 🔧 مكونات النظام الجديدة

#### 1. useOfflineSync Hook
```typescript
const {
  isOnline,           // حالة الاتصال
  pendingActions,     // الأعمال المعلقة
  addOfflineAction,   // إضافة عمل للقائمة
  syncPendingActions, // مزامنة الأعمال
  clearPendingActions // مسح القائمة
} = useOfflineSync();
```

#### 2. useLocalData Hook
```typescript
const {
  localData,         // البيانات المحلية
  addLocalData,      // إضافة بيانات
  updateLocalData,   // تحديث بيانات
  deleteLocalData,   // حذف بيانات
  getUnsyncedData    // البيانات غير المتزامنة
} = useLocalData('properties');
```

#### 3. OfflineStatusIndicator Component
- عرض حالة الاتصال
- قائمة الأعمال المعلقة
- أزرار للمزامنة والإدارة

### 🚀 التشغيل والاستخدام

#### تشغيل التطبيق
```bash
# تثبيت المتطلبات
npm install

# تشغيل في وضع التطوير
npm run dev

# تشغيل كتطبيق Electron
npm run electron-dev

# بناء للإنتاج
npm run build
```

#### اختبار العمل دون اتصال
1. افتح التطبيق في المتصفح
2. افتح أدوات المطور (F12)
3. اذهب إلى تبويب Network
4. اختر "Offline" لمحاكاة عدم وجود اتصال
5. جرب إضافة أو تعديل العقارات

### 📊 إدارة البيانات

#### هيكل البيانات المحلية
```
IndexedDB: maskani_local_db
├── properties (العقارات)
├── favorites (المفضلة)
├── offline_actions (الأعمال المعلقة)
└── user_data (بيانات المستخدم)
```

#### أنواع الأعمال المعلقة
- **CREATE**: إنشاء عقار جديد
- **UPDATE**: تحديث عقار موجود
- **DELETE**: حذف عقار

### 🔐 الأمان والخصوصية

- **تشفير البيانات**: جميع البيانات المحلية مشفرة
- **مصادقة آمنة**: نظام مصادقة متقدم مع Supabase
- **إدارة الجلسات**: إدارة آمنة لجلسات المستخدمين

### 🎯 خطط التطوير المستقبلية

#### المرحلة القادمة
- [ ] مزامنة الصور والملفات
- [ ] دعم العمل التعاوني دون اتصال
- [ ] تحسين خوارزميات المزامنة
- [ ] إضافة تقارير الاستخدام

#### تحسينات الأداء
- [ ] ضغط البيانات المحلية
- [ ] تحسين استراتيجيات التخزين المؤقت
- [ ] تقليل استهلاك البطارية

### 📞 الدعم والمساعدة

إذا واجهت أي مشاكل أو لديك اقتراحات:
1. تحقق من وحدة التحكم في المتصفح للأخطاء
2. امسح البيانات المحلية إذا لزم الأمر
3. تأكد من تحديث المتصفح لأحدث إصدار

### 🏗️ البنية التقنية

```
src/
├── hooks/
│   ├── useOfflineSync.tsx    # إدارة التزامن
│   ├── useLocalData.tsx      # التخزين المحلي
│   └── usePropertiesOffline.tsx # العقارات مع دعم دون اتصال
├── components/
│   ├── OfflineStatusIndicator.tsx # مؤشر الحالة
│   └── Property/
│       └── PropertyCard.tsx  # كارت العقار المحدث
├── pages/
│   └── PropertiesOffline.tsx # صفحة العقارات المحدثة
└── public/
    └── service-worker.js     # Service Worker محسن
```

---

**مسكني** - تطبيق عقارات ذكي يعمل في جميع الظروف! 🏠✨
