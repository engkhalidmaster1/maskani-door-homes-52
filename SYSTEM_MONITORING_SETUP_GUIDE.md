# دليل إعداد مراقبة النظام الحقيقية
## نظرة عامة
تم تحويل لوحة مراقبة النظام من البيانات التجريبية إلى بيانات حقيقية من قاعدة البيانات Supabase.
## الملفات المطلوبة
### 1. إنشاء الجداول
شغل هذا الملف أولاً في Supabase SQL Editor:
```sql
CREATE_SYSTEM_TABLES_SIMPLE.sql
```
### 2. إصلاح قيد التحقق
شغل هذا الملف ثانياً لإصلاح قيد التحقق للتنبيهات:
```sql
FIX_SYSTEM_ALERTS_CONSTRAINT.sql
```
### 3. إنشاء الدوال
شغل هذا الملف ثالثاً:
```sql
CREATE_SYSTEM_MONITORING_FUNCTIONS_FINAL.sql
```
### 4. إدراج البيانات التجريبية
شغل هذا الملف رابعاً:
```sql
UPDATE_SYSTEM_METRICS_FINAL.sql
```
### 5. التحقق من الإعداد
شغل هذا الملف أخيراً للتأكد من أن كل شيء يعمل:
```sql
VERIFY_SYSTEM_MONITORING_SETUP.sql
```
## كيفية التشغيل
1. **افتح Supabase Dashboard**
   - اذهب إلى مشروعك في Supabase
   - افتح SQL Editor
2. **شغل الملفات بالترتيب:**
   ```sql
   -- 1. الجداول
   \i CREATE_SYSTEM_TABLES_SIMPLE.sql
   -- 2. إصلاح قيد التحقق
   \i FIX_SYSTEM_ALERTS_CONSTRAINT.sql
   -- 3. الدوال
   \i CREATE_SYSTEM_MONITORING_FUNCTIONS_FINAL.sql
   -- 4. البيانات
   \i UPDATE_SYSTEM_METRICS_FINAL.sql
   -- 5. التحقق
   \i VERIFY_SYSTEM_MONITORING_SETUP.sql
   ```
3. **تشغيل التطبيق:**
   ```bash
   npm run dev
   ```
4. **زيارة لوحة المراقبة:**
   - اذهب إلى: `http://localhost:8081/dashboard`
   - افتح تبويب "النظام"
## الميزات الجديدة
### مؤشرات حقيقية
- عدد الاتصالات النشطة (من PostgreSQL)
- إجمالي الطلبات والفاشلة
- متوسط وقت الاستجابة
- استخدام CPU والذاكرة
- استخدام القرص
- مدة التشغيل
- تاريخ آخر نسخة احتياطية
### تنبيهات ذكية
- تنبيهات تلقائية للمشاكل
- إمكانية حل التنبيهات
- تتبع حالة التنبيهات
- إحصائيات التنبيهات
### سجلات النسخ الاحتياطي
- تتبع عمليات النسخ الاحتياطي
- حجم الملفات ومدة العملية
- حالة النجاح/الفشل
## استكشاف الأخطاء
### إذا لم تظهر البيانات
1. تأكد من تشغيل جميع ملفات SQL بالترتيب
2. تحقق من وجود أخطاء في Supabase Logs
3. تأكد من صلاحيات المستخدم
### إذا ظهرت أخطاء في التطبيق
1. تحقق من اتصال Supabase في `src/integrations/supabase/client.ts`
2. تأكد من تحديث الـ hooks في `src/hooks/useSystemHealth.tsx`
### لإعادة التشغيل
```bash
# حذف البيانات القديمة (اختياري)
DROP TABLE IF EXISTS system_metrics, system_alerts, backup_logs CASCADE;
# إعادة تشغيل الإعداد من البداية
```
## الاختبار
بعد الإعداد، يمكنك اختبار النظام عبر:
1. **في Supabase SQL Editor:**
   ```sql
   SELECT * FROM get_system_metrics();
   SELECT * FROM get_active_alerts();
   ```
2. **في المتصفح:**
   - مراقبة البيانات الحية في لوحة التحكم
   - تجربة حل التنبيهات
## التحديثات المستقبلية
- إضافة تنبيهات تلقائية بناءً على العتبات
- تكامل مع خدمات خارجية للمراقبة
- تقارير دورية بالبريد الإلكتروني
- واجهة إدارة أكثر تفصيلاً
