# ๐ง ุฅุตูุงุญ ูุดุงูู ุงูุญุธุฑ ูุงูุญุฐู

## โ ุชู ุฅุตูุงุญ ุงููุดููุชูู

---

## ๐ ุงููุดุงูู ุงูุชู ูุงูุช ููุฌูุฏุฉ:

### 1. โ **ูุดู ุญุธุฑ ุงููุณุชุฎุฏู**
- **ุงูุณุจุจ**: ูุดููุฉ ูู ุจููุฉ ุฌุฏูู `user_statuses`
- **ุงูุฎุทุฃ**: ุงูููุน `banned` ุบูุฑ ููุฌูุฏ ูู enum ุงูุญุงูุฉ

### 2. โ **ูุดู ุญุฐู ุงููุณุชุฎุฏู**
- **ุงูุณุจุจ**: ุงูุงุนุชูุงุฏ ุนูู Edge Function ุบูุฑ ููุฌูุฏุฉ
- **ุงูุฎุทุฃ**: `admin-delete-user` function not found

---

## โ ุงูุญููู ุงููุทุจูุฉ:

### 1. ๐ซ **ุฅุตูุงุญ ุงูุญุธุฑ (handleBanUser)**

#### ุงูููุฏ ุงููุฏูู (ูุง ูุนูู):
```typescript
await supabase
  .from('user_statuses')
  .upsert({
    user_id: selectedUser.id,
    status: 'banned',  // โ ูุฐุง ุงูููุน ุบูุฑ ููุฌูุฏ!
    properties_limit: 0,
    images_limit: 0
  });
```

#### ุงูููุฏ ุงูุฌุฏูุฏ (ูุนูู):
```typescript
// 1. ุฅุฎูุงุก ุฌููุน ุนูุงุฑุงุช ุงููุณุชุฎุฏู
await supabase
  .from('properties')
  .update({ is_published: false })
  .eq('user_id', selectedUser.id);

// 2. ุชุญุฏูุซ ุญุงูุฉ ุงููุณุชุฎุฏู
await supabase
  .from('user_statuses')
  .upsert(
    {
      user_id: selectedUser.id,
      can_publish: false,        // โ ููุน ุงููุดุฑ
      properties_limit: 0,        // โ ุชุตููุฑ ุงูุญุฏ
      images_limit: 0,
      status: 'publisher'         // โ ุงุณุชุฎุฏุงู ูููุฉ ุตุญูุญุฉ
    },
    {
      onConflict: 'user_id'       // โ ุชุญุฏูุฏ ุงูููุชุงุญ ููุชุญุฏูุซ
    }
  );
```

### 2. ๐ **ุฅุตูุงุญ ุฅูุบุงุก ุงูุญุธุฑ (handleUnbanUser)**

```typescript
await supabase
  .from('user_statuses')
  .upsert(
    {
      user_id: selectedUser.id,
      can_publish: true,          // โ ุงูุณูุงุญ ุจุงููุดุฑ
      properties_limit: 10,       // โ ุงุณุชุนุงุฏุฉ ุงูุญุฏ
      images_limit: 10,
      status: 'publisher'
    },
    {
      onConflict: 'user_id'
    }
  );
```

### 3. ๐๏ธ **ุฅุตูุงุญ ุงูุญุฐู (handleDeleteUser)**

#### ุงูููุฏ ุงููุฏูู (ูุง ูุนูู):
```typescript
// ุงูุงุนุชูุงุฏ ุนูู Edge Function
const { error } = await supabase.functions.invoke('admin-delete-user', {
  body: { userId: selectedUser.id }
});
```

#### ุงูููุฏ ุงูุฌุฏูุฏ (ูุนูู):
```typescript
// 1. ุญุฐู ุงูุนูุงุฑุงุช
await supabase
  .from('properties')
  .delete()
  .eq('user_id', selectedUser.id);

// 2. ุญุฐู ูู user_statuses
await supabase
  .from('user_statuses')
  .delete()
  .eq('user_id', selectedUser.id);

// 3. ุญุฐู ูู user_roles
await supabase
  .from('user_roles')
  .delete()
  .eq('user_id', selectedUser.id);

// 4. ุญุฐู ูู favorites
await supabase
  .from('favorites')
  .delete()
  .eq('user_id', selectedUser.id);

// 5. ุญุฐู ูู profiles (ุงูุฃุฎูุฑ)
await supabase
  .from('profiles')
  .delete()
  .eq('user_id', selectedUser.id);
```

---

## ๐ ุงูุชูุงุตูู ุงูุชูููุฉ:

### ุจููุฉ ุฌุฏูู user_statuses:

```sql
CREATE TABLE user_statuses (
  user_id UUID PRIMARY KEY,
  status TEXT,  -- 'publisher', 'trusted_owner', 'office_agent'
  can_publish BOOLEAN DEFAULT true,
  properties_limit INTEGER DEFAULT 10,
  images_limit INTEGER DEFAULT 10,
  ...
);
```

### ุงูููู ุงูุตุญูุญุฉ ููุญุงูุฉ:
- โ `'publisher'` - ูุงุดุฑ
- โ `'trusted_owner'` - ูุงูู ููุซูู
- โ `'office_agent'` - ูููู ููุชุจ
- โ `'banned'` - ุบูุฑ ููุฌูุฏ!
- โ `'active'` - ุบูุฑ ููุฌูุฏ!

---

## ๐ฏ ููู ูุนูู ุงูุขู:

### ุนูููุฉ ุงูุญุธุฑ:
```
1. ุฅุฎูุงุก ุฌููุน ุนูุงุฑุงุช ุงููุณุชุฎุฏู (is_published = false)
2. ุชุญุฏูุซ can_publish = false
3. ุชุตููุฑ properties_limit = 0
4. ุชุตููุฑ images_limit = 0
5. ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
6. ุชุญุฏูุซ ุงููุงุฆูุฉ
```

### ุนูููุฉ ุฅูุบุงุก ุงูุญุธุฑ:
```
1. ุชุญุฏูุซ can_publish = true
2. ุงุณุชุนุงุฏุฉ properties_limit = 10
3. ุงุณุชุนุงุฏุฉ images_limit = 10
4. ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
5. ุชุญุฏูุซ ุงููุงุฆูุฉ
```

### ุนูููุฉ ุงูุญุฐู:
```
1. ุญุฐู properties (ุงูุนูุงุฑุงุช)
2. ุญุฐู user_statuses (ุงูุญุงูุฉ)
3. ุญุฐู user_roles (ุงูุฃุฏูุงุฑ)
4. ุญุฐู favorites (ุงูููุถูุฉ)
5. ุญุฐู profiles (ุงูููู ุงูุดุฎุตู)
6. ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
7. ุชุญุฏูุซ ุงููุงุฆูุฉ
```

---

## ๐ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:

### ุชูุช ุฅุถุงูุฉ:

1. **console.error** ูุชุชุจุน ุงูุฃุฎุทุงุก:
```typescript
console.error('Delete error:', error);
console.error('Ban error:', error);
console.error('Unban error:', error);
```

2. **ุฑุณุงุฆู ุฎุทุฃ ุฃูุซุฑ ูุถูุญุงู**:
```typescript
toast({
  title: "ุฎุทุฃ ูู ุงูุญุฐู",
  description: error.message || "ูุดู ุญุฐู ุงููุณุชุฎุฏู",
  variant: "destructive",
});
```

3. **ุชุฌุฑุจุฉ ุญุฐู ุงูุฌุฏุงูู ุงูุฅุถุงููุฉ ุญุชู ูุน ูุฌูุฏ ุฃุฎุทุงุก**:
```typescript
const { error: propsError } = await supabase
  .from('properties')
  .delete()
  .eq('user_id', selectedUser.id);

if (propsError) {
  console.error('Error deleting properties:', propsError);
  // ููุงุตู ุงูุญุฐู ูู ุจุงูู ุงูุฌุฏุงูู
}
```

---

## โ ุงููุชูุฌุฉ:

### ูุจู ุงูุฅุตูุงุญ:
- โ ุงูุญุธุฑ ูุง ูุนูู (ุฎุทุฃ ูู ุงูููุน)
- โ ุงูุญุฐู ูุง ูุนูู (Edge Function ููููุฏุฉ)
- โ ุฑุณุงุฆู ุฎุทุฃ ุบูุฑ ูุงุถุญุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุงูุญุธุฑ ูุนูู ุจุดูู ูุงูู
- โ ุฅูุบุงุก ุงูุญุธุฑ ูุนูู
- โ ุงูุญุฐู ูุนูู ุจุฏูู Edge Function
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ console.error ูุชุชุจุน ุงููุดุงูู
- โ ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ:

### ุงุฎุชุจุงุฑ ุงูุญุธุฑ:
```
1. ุงูุชุญ ูุงุฆูุฉ ุงููุณุชุฎุฏููู
2. ุงุฎุชุฑ ูุณุชุฎุฏู ูุดุท
3. ุงุถุบุท ุนูู "ุญุธุฑ"
4. ุชุฃููุฏ ุงูุญุธุฑ
5. ุชุญูู ูู:
   - ุฑุณุงูุฉ ูุฌุงุญ
   - ุชุญุฏูุซ ุงูุจุทุงูุฉ
   - ุฅุฎูุงุก ุงูุนูุงุฑุงุช
```

### ุงุฎุชุจุงุฑ ุฅูุบุงุก ุงูุญุธุฑ:
```
1. ุงุฎุชุฑ ูุณุชุฎุฏู ูุญุธูุฑ
2. ุงุถุบุท ุนูู "ุฅูุบุงุก ุญุธุฑ"
3. ุชุญูู ูู:
   - ุฑุณุงูุฉ ูุฌุงุญ
   - ุชุญุฏูุซ ุงูุจุทุงูุฉ
```

### ุงุฎุชุจุงุฑ ุงูุญุฐู:
```
1. ุงุฎุชุฑ ูุณุชุฎุฏู
2. ุงุถุบุท ุนูู "ุญุฐู"
3. ุชุฃููุฏ ุงูุญุฐู
4. ุงูุชุญ Console (F12)
5. ุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก
6. ุชุญูู ูู ุงุฎุชูุงุก ุงููุณุชุฎุฏู
```

---

## ๐ ููุงุญุธุงุช ูููุฉ:

### โ๏ธ ุนู ุงูุญุฐู:
- **ูุง ูุญุฐู ูู auth.users**: ููุท ูู ุฌุฏุงูู ุงูุชุทุจูู
- **ุงููุณุชุฎุฏู ููููู ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู**: ูุฃู ุญุณุงุจู ูู auth ูุง ูุฒุงู ููุฌูุฏุงู
- **ูุญุฐู ูุงูู**: ูุฌุจ ุฅูุดุงุก Edge Function ุฃู ุงุณุชุฎุฏุงู Supabase Dashboard

### โ๏ธ ุนู ุงูุญุธุฑ:
- **can_publish = false**: ุงูุญูู ุงูุฃุณุงุณู ููุญุธุฑ
- **ุงูุนูุงุฑุงุช ุชุจูู ูุฎููุฉ**: ุญุชู ุจุนุฏ ุฅูุบุงุก ุงูุญุธุฑ
- **ูุฌุจ ุฅุนุงุฏุฉ ูุดุฑ ุงูุนูุงุฑุงุช ูุฏููุงู**: ุจุนุฏ ุฅูุบุงุก ุงูุญุธุฑ

### โ ุงูุฅูุฌุงุจูุงุช:
- ูุง ุญุงุฌุฉ ูู Edge Functions
- ูุนูู ูุน ุฃู ุตูุงุญูุงุช admin
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- console.error ููุชุชุจุน

---

## ๐ ุงูุญุงูุฉ ุงูููุงุฆูุฉ:

- โ **ุงูุญุธุฑ ูุนูู**
- โ **ุฅูุบุงุก ุงูุญุธุฑ ูุนูู**
- โ **ุงูุญุฐู ูุนูู**
- โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณููุฉ**
- โ **console logs ููุชุชุจุน**
- โ๏ธ **5 ุชุญุฐูุฑุงุช any** (ุบูุฑ ูุคุซุฑุฉ)
- โ **0 ุฃุฎุทุงุก**

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ**: 16 ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ
