# 🔐 دليل إدارة المستخدمين وتغيير كلمات المرور

## 📋 نظرة عامة

تم إضافة صفحة **إدارة المستخدمين** الخاصة بالمدير العام (Super Admin) مع صلاحية تغيير كلمات مرور المستخدمين.

---

## ✨ المميزات

### 1. **عرض قائمة المستخدمين**
- ✅ عرض جميع المستخدمين المسجلين في النظام
- ✅ معلومات كل مستخدم:
  - البريد الإلكتروني
  - الاسم الكامل (إن وجد)
  - حالة المستخدم (ناشر، مالك موثوق، مكلف بالنشر، صاحب مكتب)
  - حد العقارات المسموح بها
  - حد الصور المسموح بها
  - تاريخ التسجيل
  - آخر تسجيل دخول

### 2. **البحث المتقدم**
- 🔍 البحث بالبريد الإلكتروني
- 🔍 البحث بالاسم الكامل
- 🔍 البحث بمعرف المستخدم (ID)

### 3. **تغيير كلمة المرور**
- 🔑 تغيير كلمة مرور أي مستخدم
- ✅ التحقق من صحة كلمة المرور الجديدة (6 أحرف على الأقل)
- ✅ تأكيد كلمة المرور
- ✅ إظهار/إخفاء كلمة المرور
- ✅ رسائل تأكيد واضحة

### 4. **واجهة مستخدم احترافية**
- 🎨 تصميم متدرج الألوان
- 📱 متجاوب مع جميع الأجهزة
- 🔄 أزرار تحديث البيانات
- 🎯 بطاقات منظمة لكل مستخدم
- ⚡ انتقالات سلسة وتأثيرات hover

---

## 🚀 الوصول إلى الصفحة

### المسار:
```
/admin/users
```

### شروط الوصول:
1. يجب أن يكون المستخدم مسجل دخوله
2. يجب أن يكون له صلاحية **Super Admin** في جدول `admin_users`
3. يجب أن يكون حسابه نشطاً (`active = true`)

---

## 🔐 الصلاحيات المطلوبة

### في قاعدة البيانات (Supabase):

```sql
-- التحقق من أن المستخدم هو Super Admin
SELECT role, active 
FROM admin_users 
WHERE user_id = '[USER_ID]' 
  AND role = 'super_admin' 
  AND active = TRUE;
```

---

## 📸 واجهة الصفحة

### 1. **صفحة قائمة المستخدمين**

```
┌─────────────────────────────────────────────────────┐
│  👥 إدارة المستخدمين                       [تحديث] │
│  إجمالي المستخدمين: XX                             │
│                                                     │
│  🔍 [ابحث بالبريد الإلكتروني أو الاسم أو المعرف]  │
│                                                     │
│  ┌───────────────────────────────────────────────┐ │
│  │ [A] Ahmed                                     │ │
│  │     ahmed@example.com                         │ │
│  │     الحالة: 📝 ناشر                           │ │
│  │     عدد العقارات: 50  |  عدد الصور: 10       │ │
│  │     تاريخ التسجيل: 2025-01-01                │ │
│  │     [🔑 تغيير كلمة المرور]                    │ │
│  └───────────────────────────────────────────────┘ │
│                                                     │
│  ┌───────────────────────────────────────────────┐ │
│  │ [M] Mohamed                                   │ │
│  │     mohamed@example.com                       │ │
│  │     الحالة: 🏆 مالك موثوق                     │ │
│  │     عدد العقارات: 100 |  عدد الصور: 20       │ │
│  │     تاريخ التسجيل: 2025-01-15                │ │
│  │     [🔑 تغيير كلمة المرور]                    │ │
│  └───────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

### 2. **نافذة تغيير كلمة المرور**

```
┌─────────────────────────────────────┐
│  🔑 تغيير كلمة المرور              │
│  تغيير كلمة المرور للمستخدم:       │
│  ahmed@example.com                  │
│                                     │
│  🔑 كلمة المرور الجديدة            │
│  [____________] 👁                  │
│  (6 أحرف على الأقل)                │
│                                     │
│  ✅ تأكيد كلمة المرور               │
│  [____________]                     │
│                                     │
│  ✓ كلمات المرور متطابقة             │
│                                     │
│  ⚠️ ملاحظات هامة:                  │
│  • كلمة المرور يجب أن تكون 6 أحرف  │
│  • سيتم تغيير كلمة المرور فوراً    │
│  • سيحتاج المستخدم لتسجيل الدخول    │
│    بكلمة المرور الجديدة            │
│                                     │
│  [إلغاء]  [🔑 تغيير كلمة المرور]   │
└─────────────────────────────────────┘
```

---

## 🔧 الاستخدام

### 1. **الوصول إلى الصفحة**
1. سجل دخولك كمدير عام (Super Admin)
2. من القائمة الجانبية، اختر **"إدارة المستخدمين"**
3. أو اذهب مباشرة إلى: `http://localhost:8082/admin/users`

### 2. **البحث عن مستخدم**
1. اكتب في حقل البحث:
   - البريد الإلكتروني
   - الاسم الكامل
   - أو معرف المستخدم
2. سيتم تصفية القائمة تلقائياً

### 3. **تغيير كلمة المرور**
1. اضغط على زر **"🔑 تغيير كلمة المرور"** بجانب المستخدم
2. أدخل كلمة المرور الجديدة (6 أحرف على الأقل)
3. أعد إدخال كلمة المرور في حقل التأكيد
4. تأكد من تطابق كلمتي المرور (سيظهر ✓ أخضر)
5. اضغط **"تغيير كلمة المرور"**
6. سيظهر إشعار بنجاح العملية

### 4. **تحديث القائمة**
- اضغط على زر **"تحديث"** في الزاوية العلوية اليمنى لإعادة تحميل البيانات

---

## 🛡️ الأمان

### 1. **التحقق من الصلاحيات**
- ✅ يتم التحقق من صلاحية Super Admin عند تحميل الصفحة
- ✅ لا يمكن الوصول للصفحة بدون صلاحيات
- ✅ رسالة خطأ واضحة للمستخدمين غير المصرح لهم

### 2. **التحقق من كلمة المرور**
- ✅ كلمة المرور يجب أن تكون 6 أحرف على الأقل
- ✅ التأكد من تطابق كلمة المرور مع التأكيد
- ✅ استخدام Supabase Admin API لتغيير كلمة المرور بشكل آمن

### 3. **رسائل الخطأ**
- ✅ رسائل واضحة عند فشل العملية
- ✅ رسائل نجاح عند إتمام العملية
- ✅ تسجيل الأخطاء في Console للمطورين

---

## 📊 حالات المستخدم

| الحالة | الأيقونة | اللون | الوصف |
|--------|----------|-------|-------|
| ناشر | 📝 | أزرق | مستخدم عادي يمكنه نشر عدد محدود من العقارات |
| مالك موثوق | 🏆 | أخضر | مستخدم موثوق بحد أعلى من العقارات |
| مكلف بالنشر | 🏢 | بنفسجي | موظف مكلف بالنشر من قبل مكتب عقاري |
| صاحب مكتب | 👔 | برتقالي | مالك مكتب عقاري |

---

## 🔄 تدفق العمل

```
المدير العام
    ↓
تسجيل الدخول
    ↓
إدارة المستخدمين
    ↓
[البحث عن مستخدم]
    ↓
اختيار مستخدم
    ↓
الضغط على "تغيير كلمة المرور"
    ↓
إدخال كلمة مرور جديدة
    ↓
تأكيد كلمة المرور
    ↓
التحقق من الصحة
    ↓
تغيير كلمة المرور في Supabase
    ↓
✅ نجاح - إظهار رسالة تأكيد
```

---

## 🐛 استكشاف الأخطاء

### المشكلة: لا يمكن الوصول إلى الصفحة
**الحل:**
1. تأكد من تسجيل الدخول
2. تحقق من صلاحية Super Admin في قاعدة البيانات:
   ```sql
   SELECT * FROM admin_users WHERE user_id = '[YOUR_USER_ID]';
   ```
3. تأكد من أن `active = true`

### المشكلة: لا يظهر أي مستخدم
**الحل:**
1. تحقق من اتصال Supabase
2. تأكد من أن جدول `auth.users` يحتوي على مستخدمين
3. افتح Console في المتصفح وابحث عن أخطاء

### المشكلة: فشل تغيير كلمة المرور
**الحل:**
1. تأكد من أن كلمة المرور 6 أحرف على الأقل
2. تحقق من أن كلمة المرور متطابقة مع التأكيد
3. تأكد من صلاحيات Admin API في Supabase

---

## 📝 الملفات المضافة/المعدلة

### ملفات جديدة:
1. **`src/pages/UsersManagement.tsx`**
   - صفحة إدارة المستخدمين الرئيسية
   - واجهة المستخدم الكاملة
   - منطق تغيير كلمة المرور

### ملفات معدلة:
1. **`src/App.tsx`**
   - إضافة مسار `/admin/users`
   - استيراد مكون `UsersManagement`

2. **`src/components/Layout/Sidebar.tsx`**
   - إضافة رابط "إدارة المستخدمين" للمدير العام
   - استيراد أيقونة `Users` من lucide-react

---

## 🎯 الخطوات التالية (اختياري)

### تحسينات مستقبلية:
1. ✨ إضافة فلتر حسب حالة المستخدم
2. ✨ إضافة فرز حسب تاريخ التسجيل
3. ✨ إضافة تصدير قائمة المستخدمين (Excel/CSV)
4. ✨ إضافة إحصائيات متقدمة
5. ✨ إضافة صلاحية تعديل حدود العقارات والصور
6. ✨ إضافة صلاحية حظر/تفعيل المستخدمين
7. ✨ إضافة سجل تاريخ التغييرات

---

## 📞 الدعم

في حالة وجود أي مشاكل أو استفسارات، يرجى:
1. فحص Console في المتصفح للأخطاء
2. التحقق من صلاحيات Supabase
3. مراجعة هذا الدليل

---

## ✅ الخلاصة

تم بنجاح إضافة صفحة **إدارة المستخدمين** مع:
- ✅ عرض قائمة شاملة بجميع المستخدمين
- ✅ بحث متقدم
- ✅ تغيير كلمة المرور لأي مستخدم
- ✅ واجهة احترافية ومتجاوبة
- ✅ أمان عالي مع التحقق من الصلاحيات
- ✅ رسائل تأكيد واضحة
- ✅ سهولة في الاستخدام

**المسار:** `/admin/users`  
**الصلاحيات:** Super Admin فقط  
**التاريخ:** 14 أكتوبر 2025

---

**تم التطوير بواسطة:** فريق تطوير سكني  
**الإصدار:** 1.0.0
