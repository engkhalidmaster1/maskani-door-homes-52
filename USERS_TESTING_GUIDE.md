# ✅ دليل الاختبار السريع لنظام إدارة المستخدمين

**الهدف**: التأكد من عمل جميع الوظائف بشكل صحيح

---

## 🚀 البدء السريع

### 1. فتح Dashboard
```
1. سجل دخول كمدير (Admin)
2. اذهب إلى Dashboard
3. اختر تبويب "المستخدمون" من القائمة الجانبية
```

**النتيجة المتوقعة**: ✅ ظهور جدول المستخدمين مع 4 بطاقات إحصائية

---

## 📋 قائمة الاختبارات

### ✅ اختبار 1: الإحصائيات

**الخطوات**:
1. انظر إلى البطاقات الأربع في الأعلى

**تحقق من**:
- ✅ إجمالي المستخدمين (رقم + أيقونة Users)
- ✅ النشطون (رقم أخضر + دائرة خضراء)
- ✅ المحظورون (رقم أحمر + دائرة حمراء)
- ✅ المديرون (رقم أزرق + دائرة زرقاء)

**النتيجة**: يجب أن تظهر الأرقام الصحيحة لكل فئة

---

### ✅ اختبار 2: البحث

**الخطوات**:
1. اكتب في مربع البحث: اسم مستخدم موجود
2. انتظر قليلاً

**تحقق من**:
- ✅ تصفية النتائج فوراً
- ✅ عرض المستخدمين المطابقين فقط
- ✅ تحديث عداد النتائج

**جرب البحث بـ**:
- الاسم الكامل
- جزء من الاسم
- البريد الإلكتروني
- رقم الهاتف

**النتيجة**: يجب أن يعرض المستخدمين المطابقين فقط

---

### ✅ اختبار 3: فلتر الدور

**الخطوات**:
1. اضغط على قائمة "الدور"
2. اختر "مدير"

**تحقق من**:
- ✅ عرض المديرين فقط
- ✅ تحديث عداد النتائج
- ✅ ظهور Badge "مدير" على جميع المستخدمين

**كرر مع**: "مستخدم"

**النتيجة**: يجب أن يعرض النوع المختار فقط

---

### ✅ اختبار 4: فلتر الحالة

**الخطوات**:
1. اضغط على قائمة "الحالة"
2. اختر "نشط"

**تحقق من**:
- ✅ عرض المستخدمين النشطين فقط
- ✅ جميعهم لديهم Badge "نشط"

**كرر مع**:
- محظور
- معلق
- معلق الموافقة

**النتيجة**: يجب أن يعرض الحالة المختارة فقط

---

### ✅ اختبار 5: فلتر التاريخ

**الخطوات**:
1. اضغط على قائمة "تاريخ التسجيل"
2. اختر "اليوم"

**تحقق من**:
- ✅ عرض المسجلين اليوم فقط

**كرر مع**:
- آخر أسبوع
- آخر شهر
- آخر سنة

**النتيجة**: يجب أن يعرض النطاق الزمني المختار

---

### ✅ اختبار 6: فلتر العقارات

**الخطوات**:
1. اضغط على قائمة "العقارات"
2. اختر "بدون عقارات"

**تحقق من**:
- ✅ عرض المستخدمين بدون عقارات فقط
- ✅ عمود "العقارات" يظهر 0

**كرر مع**:
- لديهم عقارات
- وصلوا للحد الأقصى

**النتيجة**: يجب أن يعرض الفئة المختارة فقط

---

### ✅ اختبار 7: الفلاتر المتعددة

**الخطوات**:
1. اختر "مدير" من الدور
2. اختر "نشط" من الحالة
3. اختر "آخر شهر" من التاريخ

**تحقق من**:
- ✅ عرض المديرين النشطين المسجلين في آخر شهر فقط
- ✅ تحديث عداد النتائج

**النتيجة**: يجب أن يطبق جميع الفلاتر معاً

---

### ✅ اختبار 8: إعادة تعيين الفلاتر

**الخطوات**:
1. طبّق عدة فلاتر
2. اضغط زر "إعادة تعيين الفلاتر"

**تحقق من**:
- ✅ إزالة جميع الفلاتر
- ✅ عرض جميع المستخدمين
- ✅ مربع البحث فارغ

**النتيجة**: يجب أن يعود كل شيء للحالة الأولى

---

### ✅ اختبار 9: Pagination

**الخطوات**:
1. تأكد من وجود أكثر من 10 مستخدمين
2. انظر لأسفل الجدول

**تحقق من**:
- ✅ عرض "الصفحة 1 من X"
- ✅ عرض "عرض 1-10 من Y مستخدم"
- ✅ ظهور أزرار التنقل

**اضغط "التالي"**:
- ✅ الانتقال للصفحة 2
- ✅ عرض مستخدمين 11-20
- ✅ تفعيل زر "السابق"

**اضغط على رقم صفحة**:
- ✅ الانتقال لتلك الصفحة
- ✅ تحديث المستخدمين المعروضين

**النتيجة**: يجب أن ينتقل بسلاسة بين الصفحات

---

### ✅ اختبار 10: زر العرض (View)

**الخطوات**:
1. اضغط أيقونة العين 👁️ عند أي مستخدم
2. انتظر فتح النافذة

**تحقق من**:
- ✅ فتح نافذة "تفاصيل المستخدم"
- ✅ عرض معلومات المستخدم:
  - الاسم الكامل
  - **البريد الإلكتروني** (مخفي من الجدول، يظهر هنا فقط)
  - رقم الهاتف
  - العنوان
  - تاريخ التسجيل
  - Badge الدور (مدير/مستخدم)
- ✅ عرض قائمة العقارات:
  - عنوان العقار
  - الموقع
  - Badge حالة النشر (منشور/مخفي)
  - السعر

**النتيجة**: يجب أن تظهر جميع البيانات بشكل واضح

---

### ✅ اختبار 11: زر التعديل (Edit)

**الخطوات**:
1. اضغط أيقونة القلم ✏️ عند أي مستخدم
2. في النافذة المنبثقة:
   - لاحظ الدور الحالي
   - اختر دور مختلف
   - اضغط "حفظ التغييرات"

**تحقق من**:
- ✅ ظهور رسالة "تم التحديث"
- ✅ تحديث Badge الدور في الجدول
- ✅ تحديث عداد "المديرون" (إذا غيرت لـ/من admin)

**جرب**:
- تغيير من User إلى Admin
- تغيير من Admin إلى User

**النتيجة**: يجب أن يتحدث الدور فوراً

---

### ✅ اختبار 12: زر الحظر (Ban)

**الخطوات**:
1. اختر مستخدم لديه عقارات منشورة
2. اضغط أيقونة الحظر 🚫
3. أكّد في نافذة التأكيد

**تحقق من**:
- ✅ تغيير الأيقونة إلى أيقونة إلغاء الحظر 🔓
- ✅ إخفاء جميع عقارات المستخدم
- ✅ ظهور رسالة نجاح

**اذهب للصفحة الرئيسية**:
- ✅ عدم ظهور عقارات المستخدم المحظور

**النتيجة**: يجب أن تختفي عقارات المستخدم من الموقع

---

### ✅ اختبار 13: زر إلغاء الحظر (Unban)

**الخطوات**:
1. اختر نفس المستخدم المحظور
2. اضغط أيقونة إلغاء الحظر 🔓
3. أكّد في نافذة التأكيد

**تحقق من**:
- ✅ تغيير الأيقونة إلى أيقونة الحظر 🚫
- ✅ نشر جميع عقارات المستخدم
- ✅ ظهور رسالة نجاح

**اذهب للصفحة الرئيسية**:
- ✅ ظهور عقارات المستخدم مرة أخرى

**النتيجة**: يجب أن تظهر عقارات المستخدم في الموقع

---

### ✅ اختبار 14: تغيير الحالة

**الخطوات**:
1. اضغط على Badge الحالة (مثل "ناشر")
2. اختر حالة مختلفة (مثل "مالك موثوق")
3. اضغط "تأكيد" في النافذة

**تحقق من**:
- ✅ تحديث Badge الحالة
- ✅ تحديث الحدود في عمود "الحدود":
  - ناشر → 1 عقار، 2 صور
  - مالك موثوق → 5 عقارات، 5 صور
  - مكلف بالنشر → غير محدود، 7 صور
- ✅ ظهور رسالة نجاح

**جرب التغيير بين**:
- ناشر → مالك موثوق
- مالك موثوق → مكلف بالنشر
- مكلف بالنشر → ناشر

**النتيجة**: يجب أن تتحدث الحالة والحدود فوراً

---

### ✅ اختبار 15: زر الحذف (Delete) 🔴

**⚠️ هذا الاختبار يحذف المستخدم فعلياً!**

#### قبل الاختبار:
```bash
# تأكد من نشر Edge Function أولاً
npx supabase functions deploy admin-delete-user
```

**أو عبر Dashboard**:
```
1. افتح: https://supabase.com/dashboard/project/ugefzrktqeyspnzhxzzw/functions
2. تأكد من وجود "admin-delete-user" بحالة Active
```

#### الاختبار:

**الخطوات**:
1. **استخدم مستخدم تجريبي فقط!**
2. اضغط أيقونة سلة المهملات 🗑️
3. أكّد في نافذة التأكيد

**تحقق من**:
- ✅ ظهور رسالة "تم حذف المستخدم بنجاح"
- ✅ اختفاء المستخدم من الجدول
- ✅ تحديث عداد "إجمالي المستخدمين"

**في قاعدة البيانات**:
- ✅ حذف المستخدم من auth.users
- ✅ حذف تلقائي من profiles
- ✅ حذف تلقائي من user_roles
- ✅ حذف تلقائي من user_status_data
- ✅ حذف تلقائي من properties
- ✅ حذف تلقائي من favorites

**في حالة ظهور خطأ CORS**:
```
Error: CORS policy...
```
**الحل**: Edge Function غير منشور! راجع `DEPLOY_NOW.md`

**النتيجة**: يجب أن يُحذف المستخدم بالكامل

---

## 🎯 اختبارات إضافية

### ✅ اختبار 16: Responsive Design

**الخطوات**:
1. افتح DevTools (F12)
2. اختر وضع Mobile (Ctrl+Shift+M)

**تحقق من**:
- ✅ الجدول يتحول لتمرير أفقي
- ✅ البطاقات الإحصائية تتحول لعمود واحد
- ✅ الفلاتر تتحول لعمود واحد
- ✅ الأزرار بأحجام مناسبة للمس

**جرب أحجام**:
- Mobile (320px)
- Tablet (768px)
- Desktop (1024px+)

**النتيجة**: يجب أن يعمل بسلاسة على جميع الأحجام

---

### ✅ اختبار 17: الأداء

**الخطوات**:
1. افتح DevTools → Network
2. أعد تحميل الصفحة

**تحقق من**:
- ✅ وقت التحميل < 2 ثانية
- ✅ عدد الطلبات معقول
- ✅ لا توجد طلبات فاشلة

**اختبر الفلترة**:
- ✅ فورية (لا تأخير)
- ✅ لا طلبات جديدة للسيرفر

**النتيجة**: يجب أن يكون الأداء ممتاز

---

### ✅ اختبار 18: معالجة الأخطاء

**السيناريو 1: بدون صلاحيات**
```
1. سجل دخول كمستخدم عادي (ليس Admin)
2. حاول الوصول لـ Dashboard
```
**النتيجة**: ✅ "ليس لديك صلاحية للوصول"

**السيناريو 2: Edge Function غير منشور**
```
1. حاول حذف مستخدم
```
**النتيجة**: ⚠️ رسالة CORS error (راجع DEPLOY_NOW.md)

**السيناريو 3: مستخدم غير موجود**
```
1. حاول عرض تفاصيل مستخدم محذوف
```
**النتيجة**: ✅ "فشل في تحميل بيانات المستخدم"

---

## 📊 نموذج تقرير الاختبار

```
✅ = نجح
❌ = فشل
⚠️ = يحتاج تحقق

┌─────────────────────────────┬────────┬──────────┐
│ الاختبار                   │ الحالة │ ملاحظات │
├─────────────────────────────┼────────┼──────────┤
│ 1. الإحصائيات              │   ✅   │          │
│ 2. البحث                   │   ✅   │          │
│ 3. فلتر الدور              │   ✅   │          │
│ 4. فلتر الحالة             │   ✅   │          │
│ 5. فلتر التاريخ            │   ✅   │          │
│ 6. فلتر العقارات           │   ✅   │          │
│ 7. الفلاتر المتعددة        │   ✅   │          │
│ 8. إعادة تعيين الفلاتر     │   ✅   │          │
│ 9. Pagination              │   ✅   │          │
│ 10. زر العرض               │   ✅   │          │
│ 11. زر التعديل             │   ✅   │          │
│ 12. زر الحظر               │   ✅   │          │
│ 13. زر إلغاء الحظر         │   ✅   │          │
│ 14. تغيير الحالة           │   ✅   │          │
│ 15. زر الحذف               │   ⚠️   │ تحقق    │
│ 16. Responsive Design      │   ✅   │          │
│ 17. الأداء                 │   ✅   │          │
│ 18. معالجة الأخطاء         │   ✅   │          │
└─────────────────────────────┴────────┴──────────┘

النتيجة الإجمالية: 17/18 (94%) ✅
```

---

## 🔧 حل المشاكل الشائعة

### ❌ المشكلة: "CORS policy error" عند الحذف

**السبب**: Edge Function غير منشور

**الحل**:
```bash
# الطريقة 1: CLI
npx supabase functions deploy admin-delete-user

# الطريقة 2: Dashboard
1. افتح: https://supabase.com/dashboard/project/ugefzrktqeyspnzhxzzw/functions
2. أنشئ/عدّل "admin-delete-user"
3. الصق الكود من: supabase/functions/admin-delete-user/index.ts
4. اضغط Deploy
```

**راجع**: `DEPLOY_NOW.md` للتفاصيل الكاملة

---

### ❌ المشكلة: "ليس لديك صلاحية"

**السبب**: المستخدم ليس Admin

**الحل**:
```sql
-- في Supabase SQL Editor
INSERT INTO user_roles (user_id, role)
VALUES ('user-id-here', 'admin');
```

---

### ❌ المشكلة: لا تظهر أي بيانات

**السبب**: لا يوجد مستخدمون في قاعدة البيانات

**الحل**:
1. سجّل مستخدمين جدد
2. أو استخدم بيانات تجريبية

---

## ✅ الخلاصة

### قائمة التحقق النهائية:

- [ ] جميع الإحصائيات تعرض أرقام صحيحة
- [ ] البحث يعمل (اسم، بريد، هاتف)
- [ ] الفلاتر الأربعة تعمل
- [ ] Pagination يعمل بسلاسة
- [ ] زر العرض يفتح النافذة بالبيانات
- [ ] زر التعديل يغير الدور
- [ ] زر الحظر يخفي العقارات
- [ ] زر إلغاء الحظر ينشر العقارات
- [ ] زر الحذف يحذف المستخدم (Edge Function منشور)
- [ ] تغيير الحالة يحدث الحدود
- [ ] Responsive على جميع الأحجام
- [ ] لا أخطاء في Console
- [ ] الأداء ممتاز

**إذا كانت جميعها ✅ → النظام جاهز تماماً! 🎉**

---

**تاريخ الدليل**: 16 أكتوبر 2025  
**الحالة**: ✅ جاهز للاختبار
